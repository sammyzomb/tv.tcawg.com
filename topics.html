<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>主題探索｜航向世界旅遊頻道</title>

  <!-- 站內樣式 -->
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">

  <!-- 必要套件：Contentful + Twemoji -->
  <script src="https://cdn.jsdelivr.net/npm/contentful@latest/dist/contentful.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js" crossorigin="anonymous"></script>

  <!-- 本頁樣式 -->
  <style>
    :root{ --bg:#ffffff; --text:#111827; --card:#ffffff; --card-border:rgba(0,0,0,.06); --accent:#e0b46a; --active-bg:#f6f6f6; }
    .dark-theme{ --bg:#0b1620; --text:#e5eef9; --card:#0f2133; --card-border:rgba(255,255,255,.08); --active-bg:#0f2133; }
    
    body{ 
      background:var(--bg); 
      color:var(--text); 
      margin:0 !important; 
      padding: 0 !important;
      min-height: 100vh !important;
    }

    .page-wrap { 
      max-width: 1200px !important; 
      margin: 0 auto !important; 
      padding: 20px 5% !important; 
    }
    
    .page-head { 
      display:flex !important; 
      align-items:center !important; 
      gap:12px !important; 
      margin: 0 0 20px 0 !important; 
      padding: 0 !important;
    }
    
    .page-head h1 { 
      font-weight:900 !important; 
      font-size:24px !important; 
      margin:0 !important; 
      padding: 0 !important;
    }
    
    .hint { 
      color:#8aa4c2 !important; 
      font-size:14px !important; 
      margin: 0 0 30px 0 !important; 
      padding: 0 !important;
    }

    /* 搜尋功能 */
    .search-section {
      margin: 0 0 40px 0 !important;
      padding: 0 !important;
    }

    .search-box {
      display: flex;
      max-width: 500px;
      margin: 0 auto 20px !important;
      border: 2px solid var(--card-border);
      border-radius: 12px;
      overflow: hidden;
      background: var(--bg);
      transition: all 0.3s ease;
    }

    .search-box:focus-within {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(224, 180, 106, 0.1);
    }

    .search-input {
      flex: 1;
      padding: 12px 16px;
      border: none;
      outline: none;
      font-size: 15px;
      background: transparent;
      color: var(--text);
    }

    .search-input::placeholder {
      color: #9ca3af;
    }

    .search-btn {
      padding: 12px 16px;
      border: none;
      background: var(--accent);
      color: white;
      cursor: pointer;
      transition: background 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .search-btn:hover {
      background: #d1a55c;
    }

    .search-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px !important;
      justify-content: center;
      margin-top: 0 !important;
      margin-bottom: 0 !important;
      padding: 0 !important;
      line-height: 1 !important;
    }

    .search-tag {
      padding: 6px 12px !important;
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px !important;
      color: var(--text);
      font-size: 13px !important;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
      margin: 0 !important;
      line-height: 1.2 !important;
    }

    .search-tag:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    /* 主題標籤特殊樣式 */
    .search-tag[data-tag*="city-secrets"],
    .search-tag[data-tag*="taste-journal"],
    .search-tag[data-tag*="travel-talk"],
    .search-tag[data-tag*="around-world"],
    .search-tag[data-tag*="food-talk"],
    .search-tag[data-tag*="play-fun"],
    .search-tag[data-tag*="time-walk"],
    .search-tag[data-tag*="nature-secrets"] {
      border-color: var(--accent);
      background: rgba(224, 180, 106, 0.1);
      font-weight: 600;
    }

    /* 搜尋結果網格樣式 */
    .search-results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      padding: 0;
    }

    @media (max-width: 768px) {
      .search-results-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 16px;
      }
    }

    @media (max-width: 480px) {
      .search-results-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
    }

    /* 搜尋結果卡片樣式 */
    .search-result-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s ease;
      cursor: pointer;
      display: flex;
      flex-direction: column;
    }

    .search-result-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .search-result-thumbnail {
      position: relative;
      width: 100%;
      height: 200px;
      overflow: hidden;
    }

    .search-result-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .search-result-play-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      transition: all 0.3s ease;
    }

    .search-result-card:hover .search-result-play-button {
      background: rgba(0, 0, 0, 0.9);
      transform: translate(-50%, -50%) scale(1.1);
    }

    .search-result-content {
      padding: 16px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .search-result-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 8px 0;
      color: var(--text);
      line-height: 1.4;
    }

    .search-result-description {
      font-size: 14px;
      color: #6b7280;
      margin: 0 0 12px 0;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      flex: 1;
    }

    .search-result-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .search-result-category {
      background: #e3f2fd;
      color: #1976d2;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .search-result-topic {
      background: #f3e5f5;
      color: #7b1fa2;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .search-tag.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    /* 主題分類網格 */
    .topics-section {
      margin-bottom: 50px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 30px;
      color: var(--text);
      text-align: center;
    }

    /* Reset 可能來自全域樣式的干擾 */
    .navbar + .page-wrap { margin-top: 0 !important; }
    .page-wrap { margin-top: 0 !important; }
    .page-head{ display:none !important; }
    .simple-page-title{ font-weight:900; font-size:24px; margin:0 0 6px 0; color:var(--text); }
    .page-head h1 { writing-mode: horizontal-tb !important; transform:none !important; rotate:none !important; }
    .page-head { position: relative; }
    
    /* 修復版面問題 */
    .header-row {
      display: flex !important;
      align-items: center !important;
      justify-content: space-between !important;
      margin-bottom: 20px !important;
      gap: 20px !important;
    }
    
    .header-left {
      flex: 0 0 auto !important;
      text-align: left !important;
    }
    
    .header-right {
      flex: 1 1 auto !important;
      display: flex !important;
      justify-content: flex-end !important;
    }
    
    .header-right .search-box {
      width: 100% !important;
      max-width: 400px !important;
      margin: 0 !important;
    }

    /* 響應式設計修復 - 將在下方合併到主要媒體查詢中 */

    .topics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 30px;
      margin-top: 0;
    }

    .topic-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 0;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      min-height: 280px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }


    .topic-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      border-color: var(--accent);
    }

    .topic-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.7) 100%);
      z-index: 1;
    }

    .topic-content {
      position: relative;
      z-index: 2;
      padding: 24px;
      color: white;
    }

    .topic-icon {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      color: white;
      font-size: 24px;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .topic-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

    .topic-desc {
      color: rgba(255, 255, 255, 0.9);
      font-size: 14px;
      line-height: 1.4;
      margin-bottom: 16px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }

    .topic-stats {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.8);
    }

    .topic-stats span {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* 節目列表 */
    .videos-section {
      margin: 0 !important;
    }

    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
    }

    .video-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .video-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .video-thumb {
      aspect-ratio: 16/9;
      overflow: hidden;
      background: var(--card-bg);
    }

    .video-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .video-content {
      padding: 20px;
    }

    .video-title {
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--text);
      line-height: 1.4;
      font-size: 16px;
    }

    .video-desc {
      font-size: 14px;
      color: #6b7280;
      line-height: 1.5;
      margin-bottom: 16px;
    }

    .video-cta {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
      font-size: 14px;
    }

    .video-cta:hover {
      background: #d1a55c;
    }

    /* 響應式設計 */
    @media (max-width: 768px) {
      .page-wrap {
        padding: 16px 4% !important;
      }
      
      .header-row {
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 16px !important;
      }
      
      .header-left {
        text-align: center !important;
      }
      
      .header-right {
        justify-content: center !important;
      }
      
      .header-right .search-box {
        max-width: 100% !important;
      }
      
      .topics-grid {
        grid-template-columns: 1fr;
        gap: 24px;
      }
      
      .topic-card {
        padding: 24px;
        min-height: 180px;
      }
      
      .video-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
      }
      
      .search-section {
        margin: 0 0 30px 0 !important;
      }
    }
  </style>
</head>
<body>

  <!-- 導覽列 -->
  <div class="navbar">
    <a class="logo" href="index.html"><img src="logo.png" alt="航向世界旅遊頻道 LOGO" /></a>
    
    <nav class="desktop-nav">
      <a href="index.html">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9L12 2L21 9V20a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        <span class="nav-text">首頁</span>
      </a>
      <a href="videos.html">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><path d="M8 21h8m-4-4v4"/></svg>
        <span class="nav-text">所有節目</span>
      </a>
      <a href="schedule.html">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        <span class="nav-text">節目表</span>
      </a>
      <a href="topics.html" class="active">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <span class="nav-text">主題探索</span>
      </a>
    </nav>

    <div class="nav-actions">
        <a href="#" id="theme-switcher" title="切換主題">
            <svg id="theme-icon-sun" class="nav-icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            <svg id="theme-icon-moon" class="nav-icon" style="display: none;" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </a>
        <a href="login.html" class="login-link">
            <svg class="nav-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="7" r="4.5" stroke-width="2"/><ellipse cx="10" cy="15.2" rx="6.8" ry="3.2" stroke-width="2"/></svg>
            <span class="nav-text">會員登入</span>
        </a>
        <button id="hamburger-btn" class="hamburger-btn">
            <svg viewBox="0 0 100 80" width="24" height="24">
              <rect width="100" height="15" rx="8"></rect>
              <rect y="30" width="100" height="15" rx="8"></rect>
              <rect y="60" width="100" height="15" rx="8"></rect>
            </svg>
        </button>
    </div>
  </div>

  <div id="side-menu" class="side-menu">
    <a href="index.html">首頁</a>
    <a href="videos.html">所有節目</a>
    <a href="schedule.html">節目表</a>
    <a href="topics.html">主題探索</a>
  </div>
  <div id="menu-overlay" class="menu-overlay"></div>

  <!-- 主要內容 -->
  <div class="page-wrap">
    <div class="header-row">
      <div class="header-left">
        <div class="simple-page-title">主題探索</div>
        <p class="hint">搜尋和探索不同主題的旅遊節目</p>
      </div>
      <div class="header-right">
        <div class="search-box">
          <input type="text" id="search-input" placeholder="輸入關鍵字搜尋節目..." class="search-input">
          <button id="search-btn" class="search-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- 搜尋標籤列 -->
    <div class="search-section">
      <div class="search-tags" id="search-tags">
        <!-- 熱門搜尋標籤將由 JavaScript 動態載入 -->
      </div>
    </div>

    <!-- 主題分類網格 -->
    <div class="topics-section">
      <h2 class="section-title">熱門主題分類</h2>
      <div class="topics-grid" id="topics-grid">
        <!-- 主題分類卡片將由 JavaScript 動態載入 -->
      </div>
    </div>

    <!-- 精選節目 -->
    <div class="videos-section" id="featured-videos-section" style="display: none;">
      <h2 class="section-title">精選節目</h2>
      <div class="search-results-grid" id="featured-videos">
        <!-- 節目卡片將由 JavaScript 動態載入 -->
      </div>
    </div>
  </div>

  <!-- 全螢幕播放器 -->
  <div class="fullscreen-player" id="fullscreenPlayer"></div>

  <!-- 除錯資訊 -->
  <div id="topics-debug" style="max-width:1200px;margin:20px auto;padding:12px 16px;border:1px dashed #ccc;font:12px/1.4 monospace;color:#555;background:#fafafa;display:none"></div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <!-- 移除 script.js 引用，避免載入節目表功能 -->
  
  <!-- 內嵌 JavaScript 確保功能正常 -->
  <script>
    function dbg(msg){
      const box = document.getElementById('topics-debug');
      if (!box) return;
      box.style.display = 'block';
      box.innerHTML += msg + '<br/>';
      console.log('[topics]', msg);
    }

    // 主題切換：支援太陽/月亮按鈕，並記住使用者選擇
    function applyTheme(theme){
      const isDark = theme === 'dark';
      document.body.classList.toggle('dark-theme', isDark);
      const sun = document.getElementById('theme-icon-sun');
      const moon = document.getElementById('theme-icon-moon');
      if (sun && moon){
        sun.style.display = isDark ? 'none' : '';
        moon.style.display = isDark ? '' : 'none';
      }
      try { localStorage.setItem('site-theme', theme); } catch(e) {}
    }

    function initThemeToggle(){
      let saved = 'light';
      try { saved = localStorage.getItem('site-theme') || 'light'; } catch(e) {}
      applyTheme(saved);
      const switcher = document.getElementById('theme-switcher');
      if (switcher){
        switcher.addEventListener('click', (ev)=>{
          ev.preventDefault();
          const next = document.body.classList.contains('dark-theme') ? 'light' : 'dark';
          applyTheme(next);
        });
      }
    }

    // 主題分類資料（與 admin-calendar-unified.html 保持一致）
    const TOPICS_DATA = [
      {
        id: 'city-secrets',
        title: '城市秘境',
        description: '深入城市角落、市集、文化景點，用實地體驗呈現城市故事',
        icon: '🏙️',
        tags: ['小眾景點', '在地生活', '夜市', '特色咖啡館'],
        videoCount: 0, // 將從 Contentful 動態載入
        backgroundImage: 'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
      },
      {
        id: 'taste-journal',
        title: '味覺日誌',
        description: '品嘗當地料理與街頭小吃，訪問餐廳老闆或廚師，分享食物背後的故事',
        icon: '🍽️',
        tags: ['美食故事', '街頭小吃', '在地料理', '文化背景'],
        videoCount: 0,
        backgroundImage: 'https://images.unsplash.com/photo-1555939594-58d7cb561ad1?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
      },
      {
        id: 'travel-talk',
        title: '旅途談',
        description: '邀請旅遊達人、部落客、在地人，分享旅行心得、技巧與趣聞',
        icon: '💬',
        tags: ['旅遊技巧', '節省預算', '互動討論', '實用資訊'],
        videoCount: 0,
        backgroundImage: 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
      },
      {
        id: 'around-world',
        title: '繞著地球跑',
        description: '走訪小鎮或鄉村，介紹當地文化、手作工藝、市場與特色美食',
        icon: '🌍',
        tags: ['慢節奏', '輕旅行', '手作工藝', '在地生活'],
        videoCount: 0,
        backgroundImage: 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
      },
      {
        id: 'food-talk',
        title: '食話實說',
        description: '討論特定食材、料理或美食文化，結合討論與實地示範',
        icon: '🍳',
        tags: ['食材討論', '料理文化', '教育性', '實地示範'],
        videoCount: 0,
        backgroundImage: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
      },
      {
        id: 'play-fun',
        title: '玩樂FUN',
        description: '專為家庭設計，探索適合親子活動的景點、遊樂園、動物園',
        icon: '🎮',
        tags: ['親子活動', '遊樂園', '動物園', '手作體驗'],
        videoCount: 0,
        backgroundImage: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
      },
      {
        id: 'time-walk',
        title: '時光漫遊',
        description: '走訪古蹟、博物館、傳統村落，透過歷史故事呈現深度文化旅程',
        icon: '🏛️',
        tags: ['古蹟', '博物館', '歷史故事', '文化旅程'],
        videoCount: 0,
        backgroundImage: 'https://images.unsplash.com/photo-1520637836862-4d197d17c93a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
      },
      {
        id: 'nature-secrets',
        title: '自然秘境',
        description: '探索自然景觀、野生動植物、生態保育，感受地球之美',
        icon: '🌿',
        tags: ['自然景觀', '野生動物', '生態保育', '環境保護'],
        videoCount: 0,
        backgroundImage: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
      }
    ];

    // 熱門搜尋標籤
    const POPULAR_TAGS = [
      '城市秘境', '味覺日誌', '旅途談', '繞著地球跑', '食話實說', '玩樂FUN', '時光漫遊', '自然秘境',
      '小眾景點', '在地生活', '美食故事', '旅遊技巧', '慢節奏', '親子活動', '古蹟', '自然景觀',
      '街頭小吃', '手作工藝', '歷史故事', '生態保育', '夜市', '咖啡館', '博物館', '野生動物',
      'city-secrets', 'taste-journal', 'travel-talk', 'around-world', 'food-talk', 'play-fun', 'time-walk', 'nature-secrets'
    ];

    // HTML 轉義函數
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // 渲染熱門搜尋標籤
    function renderSearchTags() {
      const container = document.getElementById('search-tags');
      if (!container) return;

      const displayTags = POPULAR_TAGS.slice(0, 24);
      
      container.innerHTML = displayTags.map(tag => `
        <span class="search-tag" data-tag="${tag}">${escapeHtml(tag)}</span>
      `).join('');

      // 添加點擊事件
      container.addEventListener('click', handleTagClick);
    }

    // 渲染主題分類卡片
    function renderTopicsGrid() {
      const container = document.getElementById('topics-grid');
      if (!container) return;

      container.innerHTML = TOPICS_DATA.map(topic => `
        <div class="topic-card" data-topic-id="${topic.id}" style="background-image: url('${topic.backgroundImage}')">
          <div class="topic-content">
            <div class="topic-icon">${topic.icon}</div>
            <div class="topic-title">${escapeHtml(topic.title)}</div>
            <div class="topic-desc">${escapeHtml(topic.description)}</div>
            <div class="topic-stats">
              <span>📺 ${topic.videoCount} 個節目</span>
              <span>🏷️ ${topic.tags.slice(0, 2).join('、')}</span>
            </div>
          </div>
        </div>
      `).join('');

      // 添加主題卡片點擊事件
      container.addEventListener('click', handleTopicClick);
    }

    // 處理標籤點擊
    function handleTagClick(e) {
      const tag = e.target.closest('.search-tag');
      if (!tag) return;

      const tagText = tag.dataset.tag;
      const searchInput = document.getElementById('search-input');
      
      searchInput.value = tagText;
      
      // 移除其他標籤的 active 狀態
      document.querySelectorAll('.search-tag').forEach(t => t.classList.remove('active'));
      
      // 添加當前標籤的 active 狀態
      tag.classList.add('active');
      
      // 執行搜尋
      performSearch(tagText);
    }

    // 處理主題卡片點擊
    function handleTopicClick(e) {
      const topicCard = e.target.closest('.topic-card');
      if (!topicCard) return;

      const topicId = topicCard.dataset.topicId;
      const topic = TOPICS_DATA.find(t => t.id === topicId);
      
      if (topic) {
        const searchInput = document.getElementById('search-input');
        searchInput.value = topic.title;
        performSearch(topic.title);
        
        const resultsSection = document.getElementById('featured-videos-section');
        if (resultsSection) {
          resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
      }
    }

    // 全域變數
    let allPrograms = [];
    let currentSearchQuery = '';

    // 從備註中提取主題標籤
    function extractTopicsFromNotes(notes) {
      if (!notes) return [];
      const matches = notes.match(/\[主題:(.*?)\]/g);
      if (!matches) return [];
      
      const topics = matches.map(m => m.replace(/\[主題:(.*?)\]/, '$1'));
      const allTopics = [];
      topics.forEach(topic => {
        if (topic.includes(',')) {
          allTopics.push(...topic.split(',').map(t => t.trim()));
        } else {
          allTopics.push(topic.trim());
        }
      });
      
      return allTopics.filter(topic => topic.length > 0);
    }

    // 從備註中提取分類
    function extractCategoryFromNotes(notes) {
      if (!notes) return '旅遊節目';
      const match = notes.match(/\[分類:(.*?)\]/);
      return match ? match[1] : '旅遊節目';
    }

    // 載入 Contentful 數據
    async function loadContentfulData() {
      try {
        if (typeof contentful === 'undefined') {
          console.log('Contentful 未載入，使用模擬數據');
          return;
        }

        const client = contentful.createClient({
          space: 'os5wf90ljenp',
          accessToken: 'lODH-WLwHwVZv7O4rFdBWjSnrzaQWGD4koeOZ1Dypj0'
        });

        const response = await client.getEntries({
          content_type: 'scheduleItem',
          include: 2,
          limit: 1000
        });

        if (response.items && response.items.length > 0) {
          console.log(`✅ 從 Contentful 載入 ${response.items.length} 個節目`);
          
          allPrograms = response.items.map(item => {
            const fields = item.fields;
            const notes = fields.notes || '';
            
            // 從備註中提取 YouTube ID
            const youtubeMatch = notes.match(/\[YouTube:([^\]]+)\]/);
            const youtubeId = youtubeMatch ? youtubeMatch[1] : '';
            
            // 清理描述文字
            let cleanDescription = notes
              .replace(/\[時間:\d{2}:\d{2}\]/g, '')
              .replace(/\[YouTube:[^\]]+\]/g, '')
              .replace(/\[分類:.*?\]/g, '')
              .replace(/\[主題:.*?\]/g, '')
              .trim();
            
            if (!cleanDescription) {
              cleanDescription = fields.title;
            }

            return {
              id: item.sys.id,
              title: fields.title,
              description: cleanDescription,
              category: extractCategoryFromNotes(notes),
              topics: extractTopicsFromNotes(notes),
              youtubeId: youtubeId,
              thumbnail: youtubeId ? `https://img.youtube.com/vi/${youtubeId}/maxresdefault.jpg` : 'https://images.unsplash.com/photo-1485846234645-a62644f84728?w=400&h=225&fit=crop',
              airDate: fields.airDate,
              publishedAt: item.sys.publishedAt || item.sys.createdAt
            };
          });

          // 更新主題統計
          updateTopicStats();
          console.log('✅ 節目數據載入完成，共', allPrograms.length, '個節目');
        }
      } catch (error) {
        console.error('載入 Contentful 數據失敗:', error);
      }
    }

    // 更新主題統計
    function updateTopicStats() {
      TOPICS_DATA.forEach(topic => {
        const count = allPrograms.filter(program => 
          program.topics && program.topics.includes(topic.id)
        ).length;
        topic.videoCount = count;
      });
      
      // 重新渲染主題網格
      renderTopicsGrid();
    }

    // 執行搜尋
    function performSearch(query) {
      const container = document.getElementById('featured-videos');
      const section = document.getElementById('featured-videos-section');
      
      if (!container || !section) return;

      currentSearchQuery = query;
      container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;">搜尋中...</div>';
      section.style.display = 'block';

      // 搜尋相關節目
      const results = searchPrograms(query);
      displaySearchResults(results, query);
    }

    // 搜尋節目
    function searchPrograms(query) {
      if (!query || allPrograms.length === 0) return [];

      const lowerQuery = query.toLowerCase();
      
      // 先進行搜尋過濾
      const searchResults = allPrograms.filter(program => {
        // 搜尋標題
        if (program.title.toLowerCase().includes(lowerQuery)) return true;
        
        // 搜尋描述
        if (program.description.toLowerCase().includes(lowerQuery)) return true;
        
        // 搜尋分類
        if (program.category.toLowerCase().includes(lowerQuery)) return true;
        
        // 搜尋主題標籤
        if (program.topics && program.topics.some(topic => 
          topic.toLowerCase().includes(lowerQuery)
        )) return true;
        
        return false;
      });

      // 去重：根據 YouTube ID 去重，保留第一個出現的
      const uniqueResults = [];
      const seenYouTubeIds = new Set();
      
      searchResults.forEach(program => {
        if (program.youtubeId && program.youtubeId.trim() !== '') {
          // 如果有 YouTube ID，檢查是否已存在
          if (!seenYouTubeIds.has(program.youtubeId)) {
            seenYouTubeIds.add(program.youtubeId);
            uniqueResults.push(program);
          }
        } else {
          // 如果沒有 YouTube ID，直接加入（避免遺漏沒有 YouTube ID 的節目）
          uniqueResults.push(program);
        }
      });

      console.log(`🔍 搜尋「${query}」：找到 ${searchResults.length} 個結果，去重後 ${uniqueResults.length} 個`);
      
      return uniqueResults;
    }

    // 顯示搜尋結果
    function displaySearchResults(results, query) {
      const container = document.getElementById('featured-videos');
      
      if (results.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 40px; color: #6b7280;">
            <div style="font-size: 48px; margin-bottom: 16px;">🔍</div>
            <div>沒有找到「${escapeHtml(query)}」的相關節目</div>
            <div style="font-size: 14px; margin-top: 8px;">請嘗試其他關鍵字或主題標籤</div>
          </div>
        `;
        return;
      }

      const resultsHtml = results.map(program => `
        <div class="search-result-card" onclick="openVideoModal('${program.youtubeId}')">
          <div class="search-result-thumbnail">
            <img src="${program.thumbnail}" alt="${escapeHtml(program.title)}">
            <div class="search-result-play-button">▶</div>
          </div>
          <div class="search-result-content">
            <h3 class="search-result-title">${escapeHtml(program.title)}</h3>
            <p class="search-result-description">${escapeHtml(program.description)}</p>
            <div class="search-result-meta">
              <span class="search-result-category">${escapeHtml(program.category)}</span>
              ${program.topics && program.topics.length > 0 ? program.topics.map(topic => `
                <span class="search-result-topic">${escapeHtml(topic)}</span>
              `).join('') : ''}
            </div>
          </div>
        </div>
      `).join('');

      container.innerHTML = `
        <div style="margin-bottom: 20px; padding: 16px; background: var(--card); border-radius: 12px; border: 1px solid var(--card-border);">
          <h2 style="margin: 0 0 8px 0; color: var(--text);">搜尋「${escapeHtml(query)}」的結果</h2>
          <p style="margin: 0; color: #6b7280; font-size: 14px;">找到 ${results.length} 個相關節目（已去除重複的 YouTube 影片）</p>
        </div>
        ${resultsHtml}
      `;
    }

    // 開啟影片模態框
    function openVideoModal(youtubeId) {
      if (!youtubeId) return;
      
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0,0,0,0.9); z-index: 10000; display: flex; 
        align-items: center; justify-content: center; padding: 20px;
      `;
      
      modal.innerHTML = `
        <div style="position: relative; width: 100%; max-width: 800px; background: white; border-radius: 12px; overflow: hidden;">
          <button onclick="this.closest('.modal').remove()" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; z-index: 10001;">×</button>
          <div style="position: relative; width: 100%; height: 0; padding-bottom: 56.25%;">
            <iframe src="https://www.youtube.com/embed/${youtubeId}?autoplay=1" 
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;" 
                    allowfullscreen></iframe>
          </div>
        </div>
      `;
      
      modal.className = 'modal';
      document.body.appendChild(modal);
      
      // 點擊背景關閉
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }

    // 設置搜尋事件
    function setupSearchEvents() {
      const searchInput = document.getElementById('search-input');
      const searchBtn = document.getElementById('search-btn');

      searchBtn.addEventListener('click', () => {
        const query = searchInput.value.trim();
        if (query) {
          performSearch(query);
        }
      });

      searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          const query = searchInput.value.trim();
          if (query) {
            performSearch(query);
          }
        }
      });
    }

    // 漢堡選單功能
    function initHamburgerMenu() {
      const hamburgerBtn = document.getElementById('hamburger-btn');
      const sideMenu = document.getElementById('side-menu');
      const menuOverlay = document.getElementById('menu-overlay');
      const body = document.body;
      
      function toggleMenu() {
        sideMenu?.classList.toggle('active');
        menuOverlay?.classList.toggle('active');
        body.classList.toggle('menu-open');
      }
      
      hamburgerBtn?.addEventListener('click', toggleMenu);
      menuOverlay?.addEventListener('click', toggleMenu);
    }

    // 頁面載入完成後初始化
    document.addEventListener('DOMContentLoaded', async () => {
      dbg('DOM 載入完成');
      initThemeToggle(); dbg('主題切換初始化完成');
      initHamburgerMenu(); dbg('漢堡選單初始化完成');
      renderSearchTags(); dbg('已渲染搜尋標籤');
      renderTopicsGrid(); dbg('已渲染主題卡片：'+TOPICS_DATA.length);
      setupSearchEvents(); dbg('已綁定搜尋事件');
      
      // 載入 Contentful 數據
      await loadContentfulData(); dbg('Contentful 數據載入完成');
    });
  </script>
</body>
</html>
