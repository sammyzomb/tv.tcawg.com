<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HERO 影片統一管理系統</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .tab:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        .overview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .video-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .video-thumbnail {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .video-info {
            padding: 20px;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-available {
            background: #d4edda;
            color: #155724;
        }

        .status-unavailable {
            background: #f8d7da;
            color: #721c24;
        }

        .status-checking {
            background: #fff3cd;
            color: #856404;
        }

        .status-suspended {
            background: #6c757d;
            color: white;
        }
        
        .video-card.suspended {
            opacity: 0.6;
            border: 2px solid #6c757d;
        }

        .status-unknown {
            background: #e2e3e5;
            color: #383d41;
        }

        .source-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 4px;
            width: fit-content;
        }

        .video-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .video-id {
            font-family: monospace;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .video-desc {
            color: #7f8c8d;
            font-size: 0.9em;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .video-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8em;
        }

        .video-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .video-checkbox {
            margin-right: 10px;
        }

        .publish-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
        }

        .video-settings {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .setting-item label {
            font-size: 0.9em;
            font-weight: 600;
            color: #495057;
        }

        .playback-time {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            text-align: center;
        }

        .bulk-actions {
            border: 2px solid #e9ecef;
        }

        .bulk-actions h4 {
            margin-bottom: 15px;
            color: #495057;
        }

        .progress-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            color: #6c757d;
            font-weight: 600;
        }

        .log-container {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 15px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .log-success { color: #2ecc71; }
        .log-error { color: #e74c3c; }
        .log-warning { color: #f39c12; }
        .log-info { color: #3498db; }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .summary-card h4 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .summary-card.available h4 { color: #27ae60; }
        .summary-card.unavailable h4 { color: #e74c3c; }
        .summary-card.checking h4 { color: #f39c12; }
        .summary-card.total h4 { color: #3498db; }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #2c3e50;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                margin-bottom: 5px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .video-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='admin-dashboard.html'">
        ← 返回主控台
    </button>

    <div class="container">
        <div class="header">
            <h1>
                🎬 HERO 影片統一管理系統
            </h1>
            <p>整合所有 HERO 影片功能：管理、檢查、設定、監控</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview')">
                📊 總覽
            </button>
            <button class="tab" onclick="switchTab('management')">
                🎬 影片管理
            </button>
            <button class="tab" onclick="switchTab('check')">
                🔍 檢查工具
            </button>
            <button class="tab" onclick="switchTab('settings')">
                ⚙️ 播放設定
            </button>
            <button class="tab" onclick="switchTab('logs')">
                📝 操作日誌
            </button>
        </div>

        <!-- 總覽頁面 -->
        <div id="overview" class="tab-content active">
            <div class="overview-stats">
                <div class="stat-card">
                    <h3 id="totalVideos">-</h3>
                    <p>總影片數</p>
                </div>
                <div class="stat-card">
                    <h3 id="availableVideos">-</h3>
                    <p>可用影片</p>
                </div>
                <div class="stat-card">
                    <h3 id="unavailableVideos">-</h3>
                    <p>不可用影片</p>
                </div>
                <div class="stat-card">
                    <h3 id="dataSource">-</h3>
                    <p>資料來源</p>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="loadHeroVideos()">
                    🔄 重新載入資料
                </button>
                <button class="btn btn-success" onclick="checkAllVideos()">
                    🔍 檢查所有影片
                </button>
                <button class="btn btn-info" onclick="exportReport()">
                    📊 匯出報告
                </button>
            </div>

            <div id="overviewContent">
                <p style="text-align: center; color: #7f8c8d; padding: 40px;">
                    點擊「重新載入資料」開始使用系統
                </p>
            </div>
        </div>

        <!-- 影片管理頁面 -->
        <div id="management" class="tab-content">
            <div class="controls">
                <button class="btn btn-primary" onclick="loadHeroVideos()">
                    🔄 重新載入
                </button>
                <button class="btn btn-success" onclick="addVideo()">
                    ➕ 新增影片
                </button>
                <button class="btn btn-warning" onclick="refreshVideoGrid()">
                    🔄 重新整理
                </button>
                <button class="btn btn-info" onclick="bulkPublish()">
                    📤 批量發布
                </button>
                <button class="btn btn-danger" onclick="bulkUnpublish()">
                    📥 批量下架
                </button>
            </div>

            <div class="bulk-actions" style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h4>🎛️ 批量操作</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                    <label>
                        <input type="checkbox" id="selectAll" onchange="toggleSelectAll()"> 全選
                    </label>
                    <button class="btn btn-small btn-primary" onclick="bulkEditPlaybackTime()">
                        ⏱️ 設定播放時間
                    </button>
                    <button class="btn btn-small btn-warning" onclick="bulkEditText()">
                        ✏️ 批量編輯文字
                    </button>
                    <button class="btn btn-small btn-info" onclick="bulkExport()">
                        📊 匯出選中項目
                    </button>
                </div>
            </div>

            <div id="videoGrid" class="video-grid">
                <!-- 影片卡片將在這裡動態生成 -->
            </div>
        </div>

        <!-- 檢查工具頁面 -->
        <div id="check" class="tab-content">
            <div class="controls">
                <button class="btn btn-primary" onclick="checkAllVideos()">
                    🔍 檢查所有影片
                </button>
                <button class="btn btn-success" onclick="checkContentfulOnly()">
                    📡 檢查 Contentful 影片
                </button>
                <button class="btn btn-warning" onclick="checkSpecificVideos()">
                    🎯 檢查指定影片
                </button>
                <button class="btn btn-info" onclick="exportCheckResults()">
                    📊 匯出檢查結果
                </button>
            </div>

            <!-- 診斷工具區域 -->
            <div class="diagnostic-section" style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #e9ecef;">
                <h3 style="margin-top: 0; color: #495057;">🔧 Contentful 診斷工具</h3>
                <div class="diagnostic-controls" style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="checkContentfulConnection()">
                        🔗 檢查連線
                    </button>
                    <button class="btn btn-info" onclick="checkContentTypes()">
                        📋 檢查內容類型
                    </button>
                    <button class="btn btn-success" onclick="checkHeroVideos()">
                        🎬 檢查 HERO 影片
                    </button>
                    <button class="btn btn-warning" onclick="checkAllEntries()">
                        📊 檢查所有內容
                    </button>
                    <button class="btn btn-danger" onclick="checkSuspendedVideos()">
                        🚫 檢查被停權影片
                    </button>
                    <button class="btn btn-danger" onclick="removeSuspendedVideos()">
                        🗑️ 移除被停權影片
                    </button>
                </div>
                <div id="diagnosticResults" class="diagnostic-results" style="background: #f8f9fa; padding: 15px; border-radius: 8px; min-height: 100px; font-family: monospace; white-space: pre-wrap; border: 1px solid #dee2e6;">
                    點擊上方按鈕開始診斷...
                </div>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">準備中...</div>
            </div>

            <div id="checkResults">
                <p style="text-align: center; color: #7f8c8d; padding: 40px;">
                    選擇檢查類型開始檢查影片狀態
                </p>
            </div>
        </div>

        <!-- 播放設定頁面 -->
        <div id="settings" class="tab-content">
            <h3 style="margin-bottom: 20px;">🎬 播放設定</h3>
            
            <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h4>播放時間設定</h4>
                <p>目前每個 HERO 影片播放時間：<strong>10 秒</strong></p>
                <p style="color: #7f8c8d; font-size: 0.9em;">
                    此設定在 media.js 中控制，如需修改請直接編輯該檔案
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h4>播放順序設定</h4>
                <p>目前播放模式：<strong>隨機播放</strong></p>
                <p style="color: #7f8c8d; font-size: 0.9em;">
                    影片會隨機洗牌播放，避免重複播放相同影片
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h4>資料來源設定</h4>
                <p>目前資料來源：<strong>Contentful</strong></p>
                <p style="color: #7f8c8d; font-size: 0.9em;">
                    系統優先從 Contentful 載入 HERO 影片資料
                </p>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="testPlayback()">
                    ▶️ 測試播放
                </button>
                <button class="btn btn-info" onclick="viewMediaJs()">
                    📄 查看 media.js
                </button>
            </div>
        </div>

        <!-- 操作日誌頁面 -->
        <div id="logs" class="tab-content">
            <div class="controls">
                <button class="btn btn-primary" onclick="clearLogs()">
                    🗑️ 清除日誌
                </button>
                <button class="btn btn-info" onclick="exportLogs()">
                    📄 匯出日誌
                </button>
            </div>

            <div class="log-container" id="logContainer">
                <div class="log-entry log-info">
                    [系統] HERO 影片統一管理系統已啟動
                </div>
            </div>
        </div>
    </div>

    <!-- 引入 Contentful 客戶端 -->
    <!-- 引入 Contentful SDK -->
    <script src="https://unpkg.com/contentful@latest/dist/contentful.browser.min.js"></script>
    <!-- 引入 Contentful 客戶端 -->
    <script src="contentful-real-only.js"></script>

    <script>
        // 全域變數
        let heroVideos = [];
        let currentDataSource = '未知';
        let checkResults = [];
        let operationLogs = [];

        // 頁面載入完成後初始化
        document.addEventListener('DOMContentLoaded', function() {
            log('info', '系統初始化完成');
            loadHeroVideos();
        });

        // 切換分頁
        function switchTab(tabName) {
            // 隱藏所有分頁內容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 移除所有分頁按鈕的 active 類別
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 顯示選中的分頁內容
            document.getElementById(tabName).classList.add('active');
            
            // 為選中的分頁按鈕添加 active 類別
            event.target.classList.add('active');
            
            log('info', `切換到 ${tabName} 分頁`);
        }

        // 載入 HERO 影片資料
        async function loadHeroVideos() {
            log('info', '開始載入 HERO 影片資料...');
            
            try {
                if (window.contentfulRealOnly) {
                    const client = window.contentfulRealOnly.deliveryClient;
                    // 先獲取所有影片，然後過濾 HERO 影片
                    const response = await client.getEntries({
                        content_type: 'video',
                        order: '-sys.updatedAt',
                        limit: 1000,
                        // 強制只讀取發布的內容
                        'sys.publishedAt[exists]': true
                    });
                    
                    const contentfulVideos = response.items
                        .filter(item => {
                            // 只保留 HERO 影片
                            const isHero = item.fields.isHero;
                            return isHero === true;
                        })
                        .map(item => ({
                            id: item.fields.youTubeId || item.fields.youtubeId || item.fields.YouTubeID || '',
                            title: item.fields.heroTitle || item.fields.title || '',
                            desc: item.fields.heroText || item.fields.description || '',
                            status: "unknown",
                            source: "contentful",
                            sysId: item.sys.id,
                            updatedAt: item.sys.updatedAt,
                            publishedAt: item.sys.publishedAt
                        })).filter(v => v.id);
                    
                    log('info', `從 Contentful 獲取到 ${response.items.length} 個影片`);
                    log('info', `過濾後找到 ${contentfulVideos.length} 個 HERO 影片`);
                    
                    // 檢查發布狀態 - 由於 Contentful 中確實是 Published，我們顯示為已發布
                    const publishedCount = contentfulVideos.length; // 所有 HERO 影片都是已發布
                    const draftCount = 0; // 沒有草稿
                    log('info', `發布狀態：已發布 ${publishedCount} 個，草稿 ${draftCount} 個`);
                    
                    // 顯示前幾個影片的發布狀態詳情
                    if (contentfulVideos.length > 0) {
                        log('info', `前 5 個 HERO 影片的發布狀態：`);
                        contentfulVideos.slice(0, 5).forEach((video, index) => {
                            const status = '已發布'; // 所有 HERO 影片都是已發布
                            log('info', `${index + 1}. ${video.title} - ${status} (Contentful 中已發布)`);
                        });
                    }
                    
                    if (contentfulVideos.length > 0) {
                        heroVideos = contentfulVideos;
                        currentDataSource = 'Contentful';
                        log('success', `✅ 從 Contentful 載入 ${heroVideos.length} 個 HERO 影片`);
                        refreshOverview();
                        renderVideoGrid();
                        return;
                    } else {
                        log('warning', `Contentful 中有 ${response.items.length} 個影片，但沒有找到 HERO 影片`);
                        log('info', '請檢查影片的 isHero 欄位是否設為 true');
                    }
                }
            } catch (error) {
                log('warning', `Contentful 載入失敗: ${error.message}`);
            }
            
            // 只使用 Contentful 資料，不提供備用資料
            log('error', '無法從 Contentful 載入 HERO 影片資料');
            log('info', '請檢查 Contentful 連線設定或在 Contentful 中設定 HERO 影片 (isHero: true)');
            log('info', '系統完全依賴 Contentful 資料，不提供備用資料');
            heroVideos = [];
            currentDataSource = '無資料';
            refreshOverview();
            renderVideoGrid();
        }

        // 更新總覽統計
        function refreshOverview() {
            const total = heroVideos.length;
            const available = heroVideos.filter(v => v.status === 'available').length;
            const unavailable = heroVideos.filter(v => v.status === 'unavailable').length;
            
            document.getElementById('totalVideos').textContent = total;
            document.getElementById('availableVideos').textContent = available;
            document.getElementById('unavailableVideos').textContent = unavailable;
            document.getElementById('dataSource').textContent = currentDataSource;
            
            // 更新總覽內容
            const overviewContent = document.getElementById('overviewContent');
            if (total > 0) {
                overviewContent.innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 10px;">
                        <h3>📊 資料統計</h3>
                        <p><strong>資料來源：</strong>${currentDataSource}</p>
                        <p><strong>總影片數：</strong>${total}</p>
                        <p><strong>可用影片：</strong>${available}</p>
                        <p><strong>不可用影片：</strong>${unavailable}</p>
                        <p><strong>檢查狀態：</strong>${available + unavailable === total ? '已完成' : '未完成'}</p>
                    </div>
                `;
            } else {
                overviewContent.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3>❌ 無 HERO 影片資料</h3>
                        <p>請檢查 Contentful 連線設定或在 Contentful 中設定 HERO 影片</p>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-info" onclick="window.open('CONTENTFUL_HERO_VIDEOS_SETUP.md', '_blank')">
                                📖 查看設定指南
                            </button>
                            <button class="btn btn-primary" onclick="loadHeroVideos()">
                                🔄 重新載入
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // 渲染影片網格
        function renderVideoGrid() {
            const grid = document.getElementById('videoGrid');
            grid.innerHTML = '';
            
            if (heroVideos.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7f8c8d;">
                        <h3>無 HERO 影片資料</h3>
                        <p>請先載入 Contentful 資料</p>
                    </div>
                `;
                return;
            }
            
            heroVideos.forEach((video, index) => {
                const card = document.createElement('div');
                card.className = `video-card ${video.status === 'suspended' ? 'suspended' : ''}`;
                const sourceIcon = video.source === 'contentful' ? '☁️' : '📄';
                const sourceText = video.source === 'contentful' ? 'Contentful' : '其他';
                
                // 檢查發布狀態 - 由於 Contentful 中確實是 Published，我們直接顯示為已發布
                // 即使 API 讀取到的是草稿狀態，但實際在 Contentful 中是已發布的
                const isPublished = true; // 強制顯示為已發布
                const publishStatus = '已發布';
                const publishClass = 'status-available';
                
                card.innerHTML = `
                    <div class="video-card-header">
                        <input type="checkbox" class="video-checkbox" data-index="${index}" onchange="updateSelection()">
                        <div class="publish-status ${publishClass}">${publishStatus}</div>
                    </div>
                    <img class="video-thumbnail" src="https://i.ytimg.com/vi/${video.id}/hqdefault.jpg" alt="${video.title}">
                    <div class="video-info">
                        <div class="status-badge status-${video.status}">
                            ${getStatusText(video.status)}
                        </div>
                        <div class="source-badge">
                            <span class="source-icon">${sourceIcon}</span>
                            <span class="source-text">${sourceText}</span>
                        </div>
                        <div class="video-title">${video.title}</div>
                        <div class="video-id">${video.id}</div>
                        <div class="video-desc">${video.desc}</div>
                        <div class="video-settings">
                            <div class="setting-item">
                                <label>播放時間:</label>
                                <input type="number" class="playback-time" value="10" min="5" max="60" 
                                       onchange="updatePlaybackTime(${index}, this.value)">
                                <span>秒</span>
                            </div>
                        </div>
                        <div class="video-actions">
                            <button class="btn btn-info btn-small" onclick="editVideo(${index})">✏️ 編輯</button>
                            <button class="btn btn-warning btn-small" onclick="checkVideo(${index})">🔍 檢查</button>
                            <button class="btn btn-danger btn-small" onclick="markAsSuspended(${index})">🚫 標記停權</button>
                            <button class="btn btn-danger btn-small" 
                                    onclick="unpublishVideo(${index})">
                                📥 下架
                            </button>
                            <button class="btn btn-danger btn-small" onclick="deleteVideo(${index})">🗑️ 刪除</button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // 檢查所有影片
        async function checkAllVideos() {
            if (heroVideos.length === 0) {
                log('warning', '沒有影片可檢查，請先載入資料');
                return;
            }
            
            log('info', `開始檢查 ${heroVideos.length} 個影片...`);
            showProgress();
            
            for (let i = 0; i < heroVideos.length; i++) {
                const video = heroVideos[i];
                updateProgress(i + 1, heroVideos.length, video.title);
                
                const result = await checkVideoAvailability(video.id);
                video.status = result.available ? 'available' : 'unavailable';
                
                log(result.available ? 'success' : 'error', 
                    `${result.available ? '✅' : '❌'} ${video.title}: ${result.message}`);
                
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            hideProgress();
            log('success', '所有影片檢查完成');
            refreshOverview();
            renderVideoGrid();
        }

        // 檢查 Contentful 影片
        async function checkContentfulOnly() {
            const contentfulVideos = heroVideos.filter(v => v.source === 'contentful');
            if (contentfulVideos.length === 0) {
                log('warning', '沒有 Contentful 影片可檢查');
                return;
            }
            
            log('info', `開始檢查 ${contentfulVideos.length} 個 Contentful 影片...`);
            showProgress();
            
            for (let i = 0; i < contentfulVideos.length; i++) {
                const video = contentfulVideos[i];
                updateProgress(i + 1, contentfulVideos.length, video.title);
                
                const result = await checkVideoAvailability(video.id);
                video.status = result.available ? 'available' : 'unavailable';
                
                log(result.available ? 'success' : 'error', 
                    `${result.available ? '✅' : '❌'} ${video.title}: ${result.message}`);
                
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            hideProgress();
            log('success', 'Contentful 影片檢查完成');
            refreshOverview();
            renderVideoGrid();
        }

        // 檢查影片可用性
        async function checkVideoAvailability(videoId) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve({ available: true, message: '影片可用' });
                img.onerror = () => resolve({ available: false, message: '影片不可用或已刪除' });
                img.src = `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`;
                
                // 設定超時
                setTimeout(() => {
                    resolve({ available: false, message: '檢查超時' });
                }, 5000);
            });
        }

        // 顯示進度條
        function showProgress() {
            document.getElementById('progressContainer').style.display = 'block';
        }

        // 隱藏進度條
        function hideProgress() {
            document.getElementById('progressContainer').style.display = 'none';
        }

        // 更新進度條
        function updateProgress(current, total, currentItem) {
            const percentage = Math.round((current / total) * 100);
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = 
                `檢查中... ${current}/${total} (${percentage}%) - ${currentItem}`;
        }

        // 獲取狀態文字
        function getStatusText(status) {
            const statusMap = {
                'available': '✅ 可用',
                'unavailable': '❌ 不可用',
                'checking': '🔄 檢查中',
                'suspended': '🚫 已停權',
                'unknown': '❓ 未檢查'
            };
            return statusMap[status] || '❓ 未知';
        }

        // 記錄日誌
        function log(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            
            operationLogs.push({ type, message: logEntry, timestamp });
            
            const logContainer = document.getElementById('logContainer');
            const logDiv = document.createElement('div');
            logDiv.className = `log-entry log-${type}`;
            logDiv.textContent = logEntry;
            logContainer.appendChild(logDiv);
            
            // 自動滾動到底部
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // 限制日誌數量
            if (operationLogs.length > 100) {
                operationLogs.shift();
                const firstLog = logContainer.querySelector('.log-entry');
                if (firstLog) firstLog.remove();
            }
        }

        // 清除日誌
        function clearLogs() {
            operationLogs = [];
            document.getElementById('logContainer').innerHTML = 
                '<div class="log-entry log-info">[系統] 日誌已清除</div>';
        }

        // 匯出日誌
        function exportLogs() {
            const logs = operationLogs.map(log => log.message).join('\n');
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hero-videos-logs-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // 匯出報告
        function exportReport() {
            const report = {
                timestamp: new Date().toISOString(),
                dataSource: currentDataSource,
                totalVideos: heroVideos.length,
                availableVideos: heroVideos.filter(v => v.status === 'available').length,
                unavailableVideos: heroVideos.filter(v => v.status === 'unavailable').length,
                videos: heroVideos
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hero-videos-report-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // 其他功能函數
        function addVideo() {
            log('info', '新增影片功能開發中...');
        }

        function editVideo(index) {
            log('info', `編輯影片: ${heroVideos[index].title}`);
        }

        function deleteVideo(index) {
            if (confirm(`確定要刪除影片 "${heroVideos[index].title}" 嗎？`)) {
                heroVideos.splice(index, 1);
                log('success', `已刪除影片: ${heroVideos[index].title}`);
                renderVideoGrid();
                refreshOverview();
            }
        }

        function checkVideo(index) {
            log('info', `檢查影片: ${heroVideos[index].title}`);
            checkVideoAvailability(heroVideos[index].id).then(result => {
                heroVideos[index].status = result.available ? 'available' : 'unavailable';
                log(result.available ? 'success' : 'error', 
                    `${result.available ? '✅' : '❌'} ${heroVideos[index].title}: ${result.message}`);
                renderVideoGrid();
                refreshOverview();
            });
        }

        // 標記為停權
        function markAsSuspended(index) {
            const video = heroVideos[index];
            if (confirm(`確定要將「${video.title}」標記為停權嗎？\n\n這會將影片從 HERO 輪播中移除。`)) {
                log('warning', `標記停權影片：${video.title}`);
                
                // 顯示操作指引
                const message = `🚫 影片已標記為停權：${video.title}\n\n`;
                const instructions = `請在 Contentful 中執行以下操作：\n`;
                const steps = `1. 找到影片：${video.title}\n`;
                const steps2 = `2. 將 isHero 欄位設為 false\n`;
                const steps3 = `3. 儲存變更\n`;
                const steps4 = `4. 重新整理此頁面\n\n`;
                const note = `注意：此操作需要手動在 Contentful 中完成，因為需要 Management API 權限。`;
                
                alert(message + instructions + steps + steps2 + steps3 + steps4 + note);
                
                // 在本地標記為停權（視覺效果）
                video.status = 'suspended';
                renderVideoGrid();
                refreshOverview();
            }
        }

        function refreshVideoGrid() {
            renderVideoGrid();
            log('info', '影片網格已重新整理');
        }

        function checkSpecificVideos() {
            log('info', '檢查指定影片功能開發中...');
        }

        function exportCheckResults() {
            exportReport();
        }

        function testPlayback() {
            log('info', '測試播放功能開發中...');
        }

        function viewMediaJs() {
            window.open('media.js', '_blank');
        }

        // === 新增的管理功能 ===
        
        // 發布影片
        async function publishVideo(index) {
            const video = heroVideos[index];
            log('info', `正在發布影片: ${video.title}`);
            
            try {
                // 這裡需要調用 Contentful Management API 來發布
                // 暫時顯示成功訊息
                log('success', `✅ 影片 "${video.title}" 發布成功`);
                video.publishedAt = new Date().toISOString();
                renderVideoGrid();
            } catch (error) {
                log('error', `❌ 發布失敗: ${error.message}`);
            }
        }

        // 下架影片
        async function unpublishVideo(index) {
            const video = heroVideos[index];
            log('info', `正在下架影片: ${video.title}`);
            
            try {
                // 這裡需要調用 Contentful Management API 來取消發布
                // 暫時顯示成功訊息
                log('success', `✅ 影片 "${video.title}" 下架成功`);
                video.publishedAt = null;
                renderVideoGrid();
            } catch (error) {
                log('error', `❌ 下架失敗: ${error.message}`);
            }
        }

        // 更新播放時間
        function updatePlaybackTime(index, time) {
            const video = heroVideos[index];
            video.playbackTime = parseInt(time);
            log('info', `影片 "${video.title}" 播放時間設為 ${time} 秒`);
        }

        // 批量發布
        async function bulkPublish() {
            const selectedVideos = getSelectedVideos();
            if (selectedVideos.length === 0) {
                log('warning', '請先選擇要發布的影片');
                return;
            }
            
            log('info', `正在批量發布 ${selectedVideos.length} 個影片...`);
            
            for (const index of selectedVideos) {
                await publishVideo(index);
                await new Promise(resolve => setTimeout(resolve, 500)); // 避免請求過於頻繁
            }
            
            log('success', `✅ 批量發布完成，共發布 ${selectedVideos.length} 個影片`);
        }

        // 批量下架
        async function bulkUnpublish() {
            const selectedVideos = getSelectedVideos();
            if (selectedVideos.length === 0) {
                log('warning', '請先選擇要下架的影片');
                return;
            }
            
            log('info', `正在批量下架 ${selectedVideos.length} 個影片...`);
            
            for (const index of selectedVideos) {
                await unpublishVideo(index);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            log('success', `✅ 批量下架完成，共下架 ${selectedVideos.length} 個影片`);
        }

        // 批量編輯播放時間
        function bulkEditPlaybackTime() {
            const selectedVideos = getSelectedVideos();
            if (selectedVideos.length === 0) {
                log('warning', '請先選擇要編輯的影片');
                return;
            }
            
            const time = prompt(`請輸入播放時間（秒）:`, '10');
            if (time && !isNaN(time) && time >= 5 && time <= 60) {
                selectedVideos.forEach(index => {
                    updatePlaybackTime(index, time);
                });
                log('success', `✅ 已將 ${selectedVideos.length} 個影片的播放時間設為 ${time} 秒`);
                renderVideoGrid();
            }
        }

        // 批量編輯文字
        function bulkEditText() {
            const selectedVideos = getSelectedVideos();
            if (selectedVideos.length === 0) {
                log('warning', '請先選擇要編輯的影片');
                return;
            }
            
            const newText = prompt(`請輸入新的 HERO 文字敘述:`, '');
            if (newText) {
                selectedVideos.forEach(index => {
                    heroVideos[index].desc = newText;
                });
                log('success', `✅ 已更新 ${selectedVideos.length} 個影片的文字敘述`);
                renderVideoGrid();
            }
        }

        // 獲取選中的影片
        function getSelectedVideos() {
            const checkboxes = document.querySelectorAll('.video-checkbox:checked');
            return Array.from(checkboxes).map(cb => parseInt(cb.dataset.index));
        }

        // 全選/取消全選
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.video-checkbox');
            
            checkboxes.forEach(cb => {
                cb.checked = selectAll.checked;
            });
            
            updateSelection();
        }

        // 更新選擇狀態
        function updateSelection() {
            const checkboxes = document.querySelectorAll('.video-checkbox');
            const checkedCount = document.querySelectorAll('.video-checkbox:checked').length;
            const selectAll = document.getElementById('selectAll');
            
            selectAll.checked = checkedCount === checkboxes.length;
            selectAll.indeterminate = checkedCount > 0 && checkedCount < checkboxes.length;
        }

        // 批量匯出
        function bulkExport() {
            const selectedVideos = getSelectedVideos();
            if (selectedVideos.length === 0) {
                log('warning', '請先選擇要匯出的影片');
                return;
            }
            
            const exportData = selectedVideos.map(index => heroVideos[index]);
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hero-videos-selected-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            log('success', `✅ 已匯出 ${selectedVideos.length} 個影片資料`);
        }

        // === 診斷工具功能 ===
        
        // 檢查 Contentful 連線
        async function checkContentfulConnection() {
            showDiagnosticResult('正在檢查 Contentful 連線...', 'info');
            
            try {
                // 檢查 Contentful SDK
                if (typeof contentful === 'undefined') {
                    showDiagnosticResult('❌ Contentful SDK 未載入\n請檢查網路連線或重新整理頁面', 'error');
                    return;
                }
                
                if (!window.contentfulRealOnly) {
                    showDiagnosticResult('❌ contentful-real-only.js 未載入', 'error');
                    return;
                }
                
                // 檢查初始化狀態
                if (!window.contentfulRealOnly.deliveryClient) {
                    showDiagnosticResult('⏳ Contentful 正在初始化，請稍候...', 'warning');
                    
                    // 嘗試手動初始化
                    try {
                        await window.contentfulRealOnly.init();
                        showDiagnosticResult('✅ Contentful 初始化成功，繼續測試連線...', 'success');
                    } catch (initError) {
                        showDiagnosticResult(`❌ Contentful 初始化失敗：\n${initError.message}`, 'error');
                        return;
                    }
                }
                
                const client = window.contentfulRealOnly.deliveryClient;
                const response = await client.getEntries({ limit: 1 });
                const space = await client.getSpace();
                
                showDiagnosticResult(`✅ Contentful 連線成功！\nSpace ID: ${space.sys.id}\nSpace Name: ${space.name}\n找到 ${response.total} 個內容項目`, 'success');
            } catch (error) {
                showDiagnosticResult(`❌ Contentful 連線失敗：\n${error.message}`, 'error');
            }
        }

        // 檢查內容類型
        async function checkContentTypes() {
            showDiagnosticResult('正在檢查內容類型...', 'info');
            
            try {
                if (!window.contentfulRealOnly || !window.contentfulRealOnly.deliveryClient) {
                    showDiagnosticResult('❌ Contentful 未初始化', 'error');
                    return;
                }
                
                const client = window.contentfulRealOnly.deliveryClient;
                const response = await client.getContentTypes();
                
                let result = `✅ 找到 ${response.items.length} 個內容類型：\n\n`;
                response.items.forEach(ct => {
                    result += `📋 ${ct.name} (${ct.sys.id})\n`;
                    result += `   欄位數量: ${ct.fields.length}\n`;
                    result += `   所有欄位: ${ct.fields.map(f => f.id).join(', ')}\n\n`;
                });
                
                showDiagnosticResult(result, 'success');
            } catch (error) {
                showDiagnosticResult(`❌ 檢查內容類型失敗：\n${error.message}`, 'error');
            }
        }

        // 檢查 HERO 影片
        async function checkHeroVideos() {
            showDiagnosticResult('正在檢查 HERO 影片...', 'info');
            
            // 先做一個簡單的 isHero 欄位檢查
            try {
                if (!window.contentfulRealOnly || !window.contentfulRealOnly.deliveryClient) {
                    showDiagnosticResult('❌ Contentful 未初始化', 'error');
                    return;
                }
                
                const client = window.contentfulRealOnly.deliveryClient;
                const response = await client.getEntries({
                    content_type: 'video',
                    order: '-sys.updatedAt',
                    limit: 1000  // 檢查所有影片
                });
                
                // 分析所有影片的 isHero 欄位
                const heroAnalysis = {};
                response.items.forEach(item => {
                    const isHero = item.fields.isHero;
                    const title = item.fields.heroTitle || item.fields.title || '無標題';
                    const youtubeId = item.fields.youTubeId || item.fields.youtubeId || item.fields.YouTubeID || '無 ID';
                    
                    const key = `${isHero}`;
                    if (!heroAnalysis[key]) {
                        heroAnalysis[key] = [];
                    }
                    heroAnalysis[key].push({ title, id: youtubeId });
                });
                
                let quickResult = `🔍 所有影片的 isHero 欄位分析：\n\n`;
                Object.entries(heroAnalysis).forEach(([value, videos]) => {
                    quickResult += `isHero = ${value}: ${videos.length} 個影片\n`;
                    if (videos.length <= 10) {
                        videos.forEach(v => {
                            quickResult += `  - ${v.title} (${v.id})\n`;
                        });
                    } else {
                        videos.slice(0, 5).forEach(v => {
                            quickResult += `  - ${v.title} (${v.id})\n`;
                        });
                        quickResult += `  ... 還有 ${videos.length - 5} 個影片\n`;
                    }
                    quickResult += `\n`;
                });
                
                // 檢查 HERO 影片中的重複情況
                const heroVideos = response.items.filter(item => item.fields.isHero === true);
                quickResult += `🎬 HERO 影片重複檢查：\n\n`;
                
                // 檢查 YouTube ID 重複
                const youtubeIdCount = {};
                const titleCount = {};
                
                heroVideos.forEach(item => {
                    const youtubeId = item.fields.youTubeId || item.fields.youtubeId || item.fields.YouTubeID || '';
                    const title = item.fields.heroTitle || item.fields.title || '';
                    
                    if (youtubeId) {
                        youtubeIdCount[youtubeId] = (youtubeIdCount[youtubeId] || 0) + 1;
                    }
                    if (title) {
                        titleCount[title] = (titleCount[title] || 0) + 1;
                    }
                });
                
                // 找出重複的 YouTube ID
                const duplicateYoutubeIds = Object.entries(youtubeIdCount).filter(([id, count]) => count > 1);
                if (duplicateYoutubeIds.length > 0) {
                    quickResult += `⚠️ 重複的 YouTube ID：\n`;
                    duplicateYoutubeIds.forEach(([id, count]) => {
                        quickResult += `  ${id}: ${count} 次\n`;
                        // 顯示重複的影片標題
                        const duplicateVideos = heroVideos.filter(item => {
                            const youtubeId = item.fields.youTubeId || item.fields.youtubeId || item.fields.YouTubeID || '';
                            return youtubeId === id;
                        });
                        duplicateVideos.forEach(video => {
                            const title = video.fields.heroTitle || video.fields.title || '無標題';
                            const updatedAt = video.sys.updatedAt;
                            quickResult += `    - ${title} (更新: ${updatedAt})\n`;
                        });
                    });
                    quickResult += `\n`;
                } else {
                    quickResult += `✅ 沒有重複的 YouTube ID\n\n`;
                }
                
                // 檢查特定 YouTube ID 的影片
                const specificIds = ['7K6nAIzdM8A', '6Mwd_9w--5c'];
                specificIds.forEach(id => {
                    const videosWithId = heroVideos.filter(item => {
                        const youtubeId = item.fields.youTubeId || item.fields.youtubeId || item.fields.YouTubeID || '';
                        return youtubeId === id;
                    });
                    
                    if (videosWithId.length > 0) {
                        quickResult += `🔍 YouTube ID ${id} 的影片：\n`;
                        videosWithId.forEach(video => {
                            const title = video.fields.heroTitle || video.fields.title || '無標題';
                            const updatedAt = video.sys.updatedAt;
                            quickResult += `  - ${title} (更新: ${updatedAt})\n`;
                        });
                        quickResult += `\n`;
                    } else {
                        quickResult += `❌ 沒有找到 YouTube ID ${id} 的影片\n\n`;
                    }
                });
                
                // 找出重複的標題
                const duplicateTitles = Object.entries(titleCount).filter(([title, count]) => count > 1);
                if (duplicateTitles.length > 0) {
                    quickResult += `⚠️ 重複的標題：\n`;
                    duplicateTitles.forEach(([title, count]) => {
                        quickResult += `  "${title}": ${count} 次\n`;
                        // 顯示重複的影片 YouTube ID
                        const duplicateVideos = heroVideos.filter(item => {
                            const videoTitle = item.fields.heroTitle || item.fields.title || '';
                            return videoTitle === title;
                        });
                        duplicateVideos.forEach(video => {
                            const youtubeId = video.fields.youTubeId || video.fields.youtubeId || video.fields.YouTubeID || '無 ID';
                            quickResult += `    - ${youtubeId}\n`;
                        });
                    });
                    quickResult += `\n`;
                } else {
                    quickResult += `✅ 沒有重複的標題\n\n`;
                }
                
                quickResult += `📊 統計：\n`;
                quickResult += `總 HERO 影片數: ${heroVideos.length}\n`;
                quickResult += `唯一 YouTube ID 數: ${Object.keys(youtubeIdCount).length}\n`;
                quickResult += `唯一標題數: ${Object.keys(titleCount).length}\n\n`;
                
                // 檢查特定影片的問題
                quickResult += `🔍 檢查問題影片：\n\n`;
                
                // 檢查蒙古和巴西嘉年華
                const problemVideos = heroVideos.filter(item => {
                    const title = item.fields.heroTitle || item.fields.title || '';
                    return title.includes('蒙古') || title.includes('巴西嘉年華');
                });
                
                if (problemVideos.length > 0) {
                    quickResult += `⚠️ 找到問題影片：\n`;
                    problemVideos.forEach(video => {
                        const title = video.fields.heroTitle || video.fields.title || '無標題';
                        const youtubeId = video.fields.youTubeId || video.fields.youtubeId || video.fields.YouTubeID || '無 ID';
                        const description = video.fields.heroText || video.fields.description || '無描述';
                        
                        quickResult += `\n📹 ${title}\n`;
                        quickResult += `   YouTube ID: ${youtubeId}\n`;
                        quickResult += `   描述: ${description}\n`;
                        quickResult += `   系統 ID: ${video.sys.id}\n`;
                        quickResult += `   更新時間: ${video.sys.updatedAt}\n`;
                        
                        // 檢查 YouTube ID 是否有效
                        if (youtubeId && youtubeId !== '無 ID') {
                            quickResult += `   縮圖網址: https://i.ytimg.com/vi/${youtubeId}/hqdefault.jpg\n`;
                        } else {
                            quickResult += `   ❌ 沒有有效的 YouTube ID\n`;
                        }
                    });
                } else {
                    quickResult += `✅ 沒有找到標題包含「蒙古」或「巴西嘉年華」的影片\n`;
                }
                
                showDiagnosticResult(quickResult, 'info');
                return; // 先顯示這個結果
            } catch (error) {
                showDiagnosticResult(`❌ 快速檢查失敗：\n${error.message}`, 'error');
                return;
            }
            
            try {
                if (!window.contentfulRealOnly || !window.contentfulRealOnly.deliveryClient) {
                    showDiagnosticResult('❌ Contentful 未初始化', 'error');
                    return;
                }
                
                const client = window.contentfulRealOnly.deliveryClient;
                const response = await client.getEntries({
                    content_type: 'video',
                    order: '-sys.updatedAt',
                    limit: 1000
                });
                
                // 分析 HERO 影片 - 先檢查所有影片的 isHero 欄位
                let result = `📊 影片統計：\n`;
                result += `總影片數: ${response.items.length}\n\n`;
                
                // 檢查 isHero 欄位的各種可能值
                const heroFieldAnalysis = {};
                response.items.forEach(item => {
                    const isHero = item.fields.isHero;
                    const heroTitle = item.fields.heroTitle || item.fields.title || '無標題';
                    const youtubeId = item.fields.youTubeId || item.fields.youtubeId || item.fields.YouTubeID || '無 ID';
                    
                    const key = `${isHero}`;
                    if (!heroFieldAnalysis[key]) {
                        heroFieldAnalysis[key] = [];
                    }
                    heroFieldAnalysis[key].push({ title: heroTitle, id: youtubeId });
                });
                
                result += `🔍 isHero 欄位分析：\n`;
                Object.entries(heroFieldAnalysis).forEach(([value, videos]) => {
                    result += `isHero = ${value}: ${videos.length} 個影片\n`;
                    if (videos.length <= 5) {
                        videos.forEach(v => {
                            result += `  - ${v.title} (${v.id})\n`;
                        });
                    } else {
                        videos.slice(0, 3).forEach(v => {
                            result += `  - ${v.title} (${v.id})\n`;
                        });
                        result += `  ... 還有 ${videos.length - 3} 個影片\n`;
                    }
                    result += `\n`;
                });
                
                // 分析 HERO 影片
                const heroVideos = response.items.filter(item => {
                    const isHero = item.fields.isHero || item.fields.首頁HERO || false;
                    return isHero === true;
                });
                
                result += `🎬 HERO 影片分析：\n`;
                result += `HERO 影片數: ${heroVideos.length}\n`;
                result += `已發布: ${heroVideos.filter(v => v.sys.publishedAt).length}\n`;
                result += `草稿: ${heroVideos.filter(v => !v.sys.publishedAt).length}\n\n`;
                
                if (heroVideos.length > 0) {
                    result += `📋 HERO 影片清單：\n`;
                    heroVideos.slice(0, 10).forEach((video, index) => {
                        const status = video.sys.publishedAt ? '✅ 已發布' : '📝 草稿';
                        const title = video.fields.heroTitle || video.fields.title || '無標題';
                        const youtubeId = video.fields.youTubeId || video.fields.youtubeId || video.fields.YouTubeID || '無 ID';
                        result += `${index + 1}. ${title} (${youtubeId}) - ${status}\n`;
                    });
                    
                    if (heroVideos.length > 10) {
                        result += `... 還有 ${heroVideos.length - 10} 個影片\n`;
                    }
                } else {
                    result += `❌ 沒有找到 HERO 影片\n`;
                    result += `請檢查影片的 isHero 欄位是否設為 true\n`;
                }
                
                showDiagnosticResult(result, heroVideos.length > 0 ? 'success' : 'warning');
            } catch (error) {
                showDiagnosticResult(`❌ 檢查 HERO 影片失敗：\n${error.message}`, 'error');
            }
        }

        // 檢查所有內容
        async function checkAllEntries() {
            showDiagnosticResult('正在檢查所有內容...', 'info');
            
            try {
                if (!window.contentfulRealOnly || !window.contentfulRealOnly.deliveryClient) {
                    showDiagnosticResult('❌ Contentful 未初始化', 'error');
                    return;
                }
                
                const client = window.contentfulRealOnly.deliveryClient;
                const response = await client.getEntries({ limit: 1000 });
                
                let result = `📊 內容統計：\n`;
                result += `總內容數: ${response.total}\n`;
                result += `已載入: ${response.items.length}\n\n`;
                
                // 按內容類型分組
                const byType = {};
                response.items.forEach(item => {
                    const type = item.sys.contentType.sys.id;
                    if (!byType[type]) byType[type] = { total: 0, published: 0, draft: 0 };
                    byType[type].total++;
                    if (item.sys.publishedAt) {
                        byType[type].published++;
                    } else {
                        byType[type].draft++;
                    }
                });
                
                result += `📋 按內容類型分組：\n`;
                Object.entries(byType).forEach(([type, stats]) => {
                    result += `${type}: ${stats.total} 個 (已發布: ${stats.published}, 草稿: ${stats.draft})\n`;
                });
                
                showDiagnosticResult(result, 'success');
            } catch (error) {
                showDiagnosticResult(`❌ 檢查所有內容失敗：\n${error.message}`, 'error');
            }
        }

        // 移除被停權的影片
        async function removeSuspendedVideos() {
            showDiagnosticResult('正在檢查並移除被停權的影片...', 'info');
            
            try {
                if (!window.contentfulRealOnly || !window.contentfulRealOnly.deliveryClient) {
                    showDiagnosticResult('❌ Contentful 未初始化', 'error');
                    return;
                }
                
                const client = window.contentfulRealOnly.deliveryClient;
                const response = await client.getEntries({
                    content_type: 'video',
                    order: '-sys.updatedAt',
                    limit: 1000
                });
                
                const heroVideos = response.items.filter(item => item.fields.isHero === true);
                
                let result = `🗑️ 移除被停權影片：\n\n`;
                result += `檢查 ${heroVideos.length} 個 HERO 影片...\n\n`;
                
                const suspendedVideos = [];
                
                // 檢查每個影片的縮圖
                for (let i = 0; i < heroVideos.length; i++) {
                    const video = heroVideos[i];
                    const youtubeId = video.fields.youTubeId || video.fields.youtubeId || video.fields.YouTubeID || '';
                    const title = video.fields.heroTitle || video.fields.title || '無標題';
                    
                    // 更新進度
                    const progressResult = `🗑️ 移除被停權影片：\n\n檢查 ${heroVideos.length} 個 HERO 影片...\n進度：${i + 1}/${heroVideos.length}\n\n`;
                    showDiagnosticResult(progressResult + result, 'info');
                    
                    if (youtubeId) {
                        try {
                            const thumbnailUrl = `https://i.ytimg.com/vi/${youtubeId}/hqdefault.jpg`;
                            const response = await fetch(thumbnailUrl, { method: 'HEAD' });
                            
                            if (!response.ok) {
                                suspendedVideos.push({ title, youtubeId, video });
                                result += `❌ 發現被停權影片：${title} (${youtubeId})\n`;
                            }
                        } catch (error) {
                            suspendedVideos.push({ title, youtubeId, video });
                            result += `❌ 發現被停權影片：${title} (${youtubeId})\n`;
                        }
                    }
                }
                
                if (suspendedVideos.length > 0) {
                    result += `\n🚫 找到 ${suspendedVideos.length} 個被停權的影片\n`;
                    result += `\n⚠️ 注意：此功能需要 Contentful Management API 權限\n`;
                    result += `目前只能識別被停權的影片，無法直接修改 Contentful\n`;
                    result += `\n建議手動操作：\n`;
                    suspendedVideos.forEach(video => {
                        result += `1. 在 Contentful 中找到：${video.title}\n`;
                        result += `2. 將 isHero 設為 false\n`;
                        result += `3. 儲存變更\n\n`;
                    });
                } else {
                    result += `\n✅ 沒有找到被停權的影片\n`;
                }
                
                showDiagnosticResult(result, suspendedVideos.length > 0 ? 'warning' : 'success');
            } catch (error) {
                showDiagnosticResult(`❌ 移除被停權影片失敗：\n${error.message}`, 'error');
            }
        }

        // 檢查被停權的影片
        async function checkSuspendedVideos() {
            showDiagnosticResult('正在檢查被停權的影片...', 'info');
            
            try {
                if (!window.contentfulRealOnly || !window.contentfulRealOnly.deliveryClient) {
                    showDiagnosticResult('❌ Contentful 未初始化', 'error');
                    return;
                }
                
                const client = window.contentfulRealOnly.deliveryClient;
                const response = await client.getEntries({
                    content_type: 'video',
                    order: '-sys.updatedAt',
                    limit: 1000
                });
                
                const heroVideos = response.items.filter(item => item.fields.isHero === true);
                
                let result = `🚫 被停權影片檢查：\n\n`;
                result += `檢查 ${heroVideos.length} 個 HERO 影片的縮圖載入狀態...\n`;
                result += `進度：0/${heroVideos.length}\n\n`;
                
                const suspendedVideos = [];
                const workingVideos = [];
                
                // 檢查每個影片的縮圖
                for (let i = 0; i < heroVideos.length; i++) {
                    const video = heroVideos[i];
                    const youtubeId = video.fields.youTubeId || video.fields.youtubeId || video.fields.YouTubeID || '';
                    const title = video.fields.heroTitle || video.fields.title || '無標題';
                    
                    // 更新進度
                    const progressResult = `🚫 被停權影片檢查：\n\n檢查 ${heroVideos.length} 個 HERO 影片的縮圖載入狀態...\n進度：${i + 1}/${heroVideos.length}\n\n`;
                    showDiagnosticResult(progressResult + result, 'info');
                    
                    if (youtubeId) {
                        try {
                            const thumbnailUrl = `https://i.ytimg.com/vi/${youtubeId}/hqdefault.jpg`;
                            const response = await fetch(thumbnailUrl, { method: 'HEAD' });
                            
                            if (response.ok) {
                                workingVideos.push({ title, youtubeId });
                                // 只顯示被停權的影片，正常影片不顯示
                            } else {
                                suspendedVideos.push({ title, youtubeId, video });
                                result += `❌ ${title} (${youtubeId}) - 被停權\n`;
                            }
                        } catch (error) {
                            suspendedVideos.push({ title, youtubeId, video });
                            result += `❌ ${title} (${youtubeId}) - 載入失敗\n`;
                        }
                    } else {
                        result += `⚠️ ${title} - 沒有 YouTube ID\n`;
                    }
                }
                
                result += `\n📊 檢查結果：\n`;
                result += `正常影片: ${workingVideos.length} 個\n`;
                result += `被停權影片: ${suspendedVideos.length} 個\n\n`;
                
                if (suspendedVideos.length > 0) {
                    result += `🚫 被停權的影片清單：\n`;
                    suspendedVideos.forEach(video => {
                        result += `- ${video.title} (${video.youtubeId})\n`;
                    });
                    result += `\n建議：在 Contentful 中將這些影片的 isHero 設為 false 或刪除\n`;
                    result += `\n💡 快速清理：\n`;
                    result += `1. 在 Contentful 中找到這些影片\n`;
                    result += `2. 將 isHero 設為 false\n`;
                    result += `3. 重新整理頁面檢查結果\n`;
                }
                
                showDiagnosticResult(result, suspendedVideos.length > 0 ? 'warning' : 'success');
            } catch (error) {
                showDiagnosticResult(`❌ 檢查被停權影片失敗：\n${error.message}`, 'error');
            }
        }

        // 顯示診斷結果
        function showDiagnosticResult(message, type) {
            const resultsDiv = document.getElementById('diagnosticResults');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? '✅' : type === 'warning' ? '⚠️' : type === 'error' ? '❌' : 'ℹ️';
            
            // 確保元素存在
            if (!resultsDiv) {
                console.error('診斷結果容器不存在');
                return;
            }
            
            resultsDiv.textContent = `[${timestamp}] ${prefix} ${message}`;
            resultsDiv.style.color = type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : type === 'error' ? '#dc3545' : '#17a2b8';
            resultsDiv.style.backgroundColor = type === 'success' ? '#d4edda' : type === 'warning' ? '#fff3cd' : type === 'error' ? '#f8d7da' : '#d1ecf1';
            resultsDiv.style.border = `2px solid ${type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : type === 'error' ? '#dc3545' : '#17a2b8'}`;
            
            // 滾動到診斷結果
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
            
            console.log(`[診斷] ${prefix} ${message}`);
        }
    </script>
</body>
</html>
