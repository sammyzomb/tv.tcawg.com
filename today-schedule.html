<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ä»Šæ—¥ç¯€ç›®è¡¨ - èˆªå‘ä¸–ç•Œæ—…éŠé »é“</title>
  
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  
  <!-- Contentful SDK -->
  <script src="https://cdn.jsdelivr.net/npm/contentful@latest/dist/contentful.browser.min.js"></script>
  <script src="browser-config.js"></script>
  <style>
    /* ä»Šæ—¥ç¯€ç›®è¡¨å°ˆç”¨æ¨£å¼ */
    .today-schedule-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
    }

    .schedule-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .calendar-icon {
      width: 40px;
      height: 40px;
      background: #2b71d2;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }

    .header-title {
      font-size: 28px;
      font-weight: 700;
      color: #2b71d2;
      margin: 0;
    }

    .header-right {
      text-align: right;
      color: #6c757d;
    }

    .time-info {
      font-size: 14px;
      margin-bottom: 5px;
    }

    .current-time {
      font-size: 18px;
      font-weight: 600;
      color: #2b71d2;
    }

    .schedule-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
      position: relative;
    }

    .schedule-carousel {
      display: flex;
      gap: 20px;
      overflow-x: auto;
      scroll-behavior: smooth;
      padding: 10px 0;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .schedule-carousel::-webkit-scrollbar {
      display: none;
    }

    .program-card {
      min-width: 320px;
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
      border: 3px solid transparent;
    }

    .program-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    }

    .program-card.current {
      border-color: #dc3545;
      box-shadow: 0 0 20px rgba(220, 53, 69, 0.3);
    }

    .program-image {
      position: relative;
      height: 200px;
      overflow: hidden;
    }

    .program-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .program-card:hover .program-image img {
      transform: scale(1.05);
    }

    .time-badge {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 14px;
    }

    .status-badge {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #dc3545;
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .program-info {
      padding: 20px;
    }

    .program-title {
      font-size: 18px;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .program-description {
      color: #6c757d;
      font-size: 14px;
      line-height: 1.5;
      margin-bottom: 15px;
    }

    .program-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .category-tag {
      background: #dc3545;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .duration-info {
      display: flex;
      align-items: center;
      gap: 5px;
      color: #6c757d;
      font-size: 12px;
    }

    .scroll-indicators {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 30px;
    }

    .indicator-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #dee2e6;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .indicator-dot.active {
      background: #2b71d2;
      transform: scale(1.2);
    }

    /* æ’­æ”¾æŒ‰éˆ•æ¨£å¼ */
    .play-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .program-card:hover .play-overlay {
      opacity: 1;
    }
    
    .play-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(43, 113, 210, 0.9);
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    
    .play-btn:hover {
      background: rgba(43, 113, 210, 1);
      transform: scale(1.1);
    }
    
    /* è§€çœ‹æŒ‰éˆ•æ¨£å¼ */
    .watch-btn {
      background: #2b71d2;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
      width: 100%;
    }
    
    .watch-btn:hover {
      background: #1e5bb8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(43, 113, 210, 0.3);
    }

    /* å…¨è¢å¹•æ’­æ”¾å™¨æ¨£å¼ */
    .fullscreen-player {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #000;
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
    }
    
    .fullscreen-player.active {
      display: flex;
    }
    
    .close-player-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      font-size: 30px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      z-index: 10001;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s ease;
    }
    
    .close-player-btn:hover {
      background: rgba(0, 0, 0, 0.9);
    }
    
    #main-player {
      width: 100%;
      height: 100%;
    }

    .scroll-arrows {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      background: rgba(255,255,255,0.9);
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      z-index: 10;
    }

    .scroll-arrows:hover {
      background: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .scroll-left {
      left: 20px;
    }

    .scroll-right {
      right: 20px;
    }

    .scroll-arrows svg {
      width: 20px;
      height: 20px;
      color: #6c757d;
    }

    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
      .schedule-header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
      }

      .header-title {
        font-size: 24px;
      }

      .program-card {
        min-width: 280px;
      }

      .scroll-arrows {
        display: none;
      }
    }

    @media (max-width: 480px) {
      .today-schedule-container {
        padding: 10px;
      }

      .schedule-content {
        padding: 20px;
      }

      .program-card {
        min-width: 250px;
      }

      .header-title {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>

  <!-- å°è¦½åˆ— -->
  <div class="navbar">
    <a class="logo" href="index.html">
      <img src="logo.png" alt="èˆªå‘ä¸–ç•Œæ—…éŠé »é“ LOGO" />
    </a>
    
    <nav class="desktop-nav">
      <a href="index.html">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9L12 2L21 9V20a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        <span class="nav-text">é¦–é </span>
      </a>
      <a href="videos.html">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><path d="M8 21h8m-4-4v4"/></svg>
        <span class="nav-text">æ‰€æœ‰ç¯€ç›®</span>
      </a>
      <a href="schedule.html">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        <span class="nav-text">ç¯€ç›®è¡¨</span>
      </a>
      <a href="topics.html">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <span class="nav-text">ä¸»é¡Œæ¢ç´¢</span>
      </a>
    </nav>

    <div class="nav-actions">
      <a href="login.html" class="login-link">
        <svg class="nav-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="7" r="4.5" stroke-width="2"/><ellipse cx="10" cy="15.2" rx="6.8" ry="3.2" stroke-width="2"/></svg>
        <span class="nav-text">æœƒå“¡ç™»å…¥</span>
      </a>
    </div>
  </div>

  <!-- ä»Šæ—¥ç¯€ç›®è¡¨ä¸»è¦å…§å®¹ -->
  <div class="today-schedule-container">
    
    <!-- é é¢æ¨™é¡Œå€å¡Š -->
    <div class="schedule-header">
      <div class="header-left">
        <div class="calendar-icon">
          ğŸ“…
        </div>
        <h1 class="header-title">ä»Šæ—¥ç¯€ç›®è¡¨</h1>
      </div>
      
      <div class="header-right">
        <div class="time-info">å°ç£æ™‚é–“</div>
        <div class="time-info" id="currentDate">9æœˆ2æ—¥ æ˜ŸæœŸäºŒ</div>
        <div class="time-info">ç¾åœ¨æ™‚é–“ <span class="current-time" id="currentTime">12:46</span></div>
        <button onclick="testPlayback()" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-left: 10px; cursor: pointer;">æ¸¬è©¦æ’­æ”¾</button>
      </div>
    </div>

    <!-- ç¯€ç›®è¡¨å…§å®¹å€å¡Š -->
    <div class="schedule-content">
      
      <!-- æ»¾å‹•ç®­é ­ -->
      <button class="scroll-arrows scroll-left" id="scrollLeft">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15,18 9,12 15,6"></polyline>
        </svg>
      </button>
      
      <button class="scroll-arrows scroll-right" id="scrollRight">
        <svg viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9,18 15,12 9,6"></polyline>
        </svg>
      </button>

      <!-- ç¯€ç›®è¼ªæ’­ -->
      <div class="schedule-carousel" id="scheduleCarousel">
        <!-- ç¯€ç›®å¡ç‰‡å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
      </div>

      <!-- æ»¾å‹•æŒ‡ç¤ºå™¨ -->
      <div class="scroll-indicators" id="scrollIndicators">
        <!-- æŒ‡ç¤ºé»å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <script>
    // ä»Šæ—¥ç¯€ç›®è¡¨ JavaScript
    document.addEventListener('DOMContentLoaded', () => {
      let currentProgramIndex = 0;
      let programs = [];
      
      // å°‡ programs è¨­ç‚ºå…¨åŸŸè®Šæ•¸ï¼Œæ–¹ä¾¿èª¿è©¦
      window.programs = programs;
      
      // åˆå§‹åŒ–
      initTodaySchedule();
      
      // åˆå§‹åŒ–ä»Šæ—¥ç¯€ç›®è¡¨
      async function initTodaySchedule() {
        await loadPrograms();
        updateDateTime();
        renderPrograms();
        setupEventListeners();
        
        // æ¯åˆ†é˜æ›´æ–°æ™‚é–“
        setInterval(updateDateTime, 60000);
        
        // æ¯30ç§’æª¢æŸ¥ç¯€ç›®ç‹€æ…‹
        setInterval(checkProgramStatus, 30000);
      }
      
      // å¾ Contentful è¼‰å…¥ç¯€ç›®æ•¸æ“š
      async function loadProgramsFromContentful() {
        try {
          // æª¢æŸ¥ Contentful SDK æ˜¯å¦è¼‰å…¥
          if (typeof contentful === 'undefined') {
            throw new Error('Contentful SDK æœªè¼‰å…¥');
          }
          
          // å‰µå»º Contentful å®¢æˆ¶ç«¯
          const client = contentful.createClient({
            space: window.CONTENTFUL_CONFIG?.SPACE_ID || 'os5wf90ljenp',
            accessToken: window.CONTENTFUL_CONFIG?.DELIVERY_TOKEN || 'lODH-WLwHwVZv7O4rFdBWjSnrzaQWGD4koeOZ1Dypj0'
          });
          
          // ç²å–ä»Šå¤©çš„æ—¥æœŸ
          const today = new Date();
          const todayString = today.getFullYear() + '-' + 
                             String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                             String(today.getDate()).padStart(2, '0');
          
          console.log('å¾ Contentful è¼‰å…¥ä»Šæ—¥ç¯€ç›®:', todayString);
          
          // æŸ¥è©¢ä»Šæ—¥çš„ç¯€ç›®
          const response = await client.getEntries({
            content_type: 'scheduleItem',
            'fields.airDate': todayString,
            include: 2 // åŒ…å«é€£çµçš„è³‡æº
          });
          
          console.log('Contentful å›æ‡‰:', response);
          
          // è½‰æ› Contentful è³‡æ–™æ ¼å¼
          programs = response.items.map(entry => {
            const fields = entry.fields;
            
            // å¾å‚™è¨»ä¸­æå–æ™‚é–“
            const notes = fields.notes?.['en-US'] || '';
            const timeMatch = notes.match(/\[æ™‚é–“:(\d{2}:\d{2})\]/);
            const airTime = timeMatch ? timeMatch[1] : '00:00';
            
            // è™•ç†ç¸®åœ–
            let thumbnail = 'https://via.placeholder.com/320x200/000000/ffffff?text=ç¯€ç›®åœ–ç‰‡';
            
            console.log('è™•ç†ç¯€ç›®ç¸®åœ–:', fields.title?.['en-US'], {
              hasThumbnail: !!(fields.thumbnail && fields.thumbnail['en-US']),
              hasThumbnailUrl: !!(fields.thumbnailUrl && fields.thumbnailUrl['en-US']),
              thumbnailAsset: fields.thumbnail?.['en-US'],
              thumbnailUrl: fields.thumbnailUrl?.['en-US']
            });
            
            // å¦‚æœæœ‰ç¸®åœ– Asset
            if (fields.thumbnail && fields.thumbnail['en-US']) {
              const thumbnailAsset = fields.thumbnail['en-US'];
              if (thumbnailAsset.fields && thumbnailAsset.fields.file) {
                thumbnail = 'https:' + thumbnailAsset.fields.file['en-US'].url;
                console.log('ä½¿ç”¨ Contentful Asset ç¸®åœ–:', thumbnail);
              }
            }
            // å¦‚æœæœ‰ç¸®åœ– URL
            else if (fields.thumbnailUrl && fields.thumbnailUrl['en-US']) {
              thumbnail = fields.thumbnailUrl['en-US'];
              console.log('ä½¿ç”¨ YouTube URL ç¸®åœ–:', thumbnail);
            }
            
            return {
              time: airTime,
              title: fields.title?.['en-US'] || 'æœªå‘½åç¯€ç›®',
              duration: "30", // é è¨­ 30 åˆ†é˜
              category: "æ—…éŠç¯€ç›®",
              description: notes.replace(/\[æ™‚é–“:\d{2}:\d{2}\]/, '').trim() || 'ç¯€ç›®æè¿°',
              thumbnail: thumbnail
            };
          });
          
          // æŒ‰æ™‚é–“æ’åº
          programs.sort((a, b) => a.time.localeCompare(b.time));
          
          // æ›´æ–°å…¨åŸŸè®Šæ•¸
          window.programs = programs;
          
          console.log('å¾ Contentful è¼‰å…¥ç¯€ç›®æˆåŠŸ:', programs.length, 'å€‹ç¯€ç›®');
          console.log('ç¯€ç›®ç¸®åœ–è³‡æ–™:', programs.map(p => ({title: p.title, thumbnail: p.thumbnail})));
          
        } catch (error) {
          console.error('å¾ Contentful è¼‰å…¥ç¯€ç›®å¤±æ•—:', error);
          throw error;
        }
      }
      
      // è¼‰å…¥ç¯€ç›®æ•¸æ“š
      async function loadPrograms() {
        try {
          // é¦–å…ˆå˜—è©¦å¾ Contentful è¼‰å…¥
          await loadProgramsFromContentful();
        } catch (error) {
          console.error('å¾ Contentful è¼‰å…¥ç¯€ç›®æ•¸æ“šå¤±æ•—:', error);
          // å¦‚æœ Contentful è¼‰å…¥å¤±æ•—ï¼Œå˜—è©¦å¾ schedule.json è¼‰å…¥
          try {
            const response = await fetch('schedule.json');
            const data = await response.json();
            programs = data.today.schedule || [];
          } catch (jsonError) {
            console.error('è¼‰å…¥ schedule.json å¤±æ•—:', jsonError);
            // ä½¿ç”¨é è¨­æ•¸æ“š
            programs = [
            {
              time: "12:00",
              title: "åˆé–“ç²¾é¸ - æ³°åœ‹æ¸…é‚å¤åŸå·¡ç¦®",
              duration: "60",
              category: "äºæ´²æ—…éŠ",
              description: "æ¼«æ­¥æ¸…é‚å¤åŸï¼Œæ„Ÿå—æ³°åŒ—è˜­ç´ç‹æœçš„æ­·å²æ–‡åŒ–",
              thumbnail: "https://images.unsplash.com/photo-1552733407-5d5c46c3bb3b?w=400&h=225&fit=crop",
              youtubeId: "3GZCJfIOg_k"
            },
            {
              time: "13:00",
              title: "æµ·å³¶å‡æœŸ - é¦¬çˆ¾åœ°å¤«æ°´ä¸Šåˆ¥å¢…",
              duration: "45",
              category: "æµ·å³¶æ—…éŠ",
              description: "åœ¨é¦¬çˆ¾åœ°å¤«çš„é€æ˜æµ·æ°´ä¸­ï¼Œé«”é©—æœ€å¥¢è¯çš„æ°´ä¸Šåˆ¥å¢…ç”Ÿæ´»",
              thumbnail: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=225&fit=crop",
              youtubeId: "LcdGhVwS3gw"
            },
            {
              time: "14:00",
              title: "æ­·å²æ¢ç´¢ - åŸƒåŠé‡‘å­—å¡”ä¹‹è¬",
              duration: "60",
              category: "æ­·å²æ—…éŠ",
              description: "æ·±å…¥æ¢ç´¢å¤åŸƒåŠé‡‘å­—å¡”çš„å»ºé€ ä¹‹è¬èˆ‡æ³•è€æ–‡æ˜",
              thumbnail: "https://images.unsplash.com/photo-1503177119275-0aa32b3a9368?w=400&h=225&fit=crop",
              youtubeId: "25Fmx1G-C3k"
            },
            {
              time: "15:00",
              title: "å†’éšªä¹‹æ—… - ç§˜é­¯é¦¬ä¸˜æ¯”ä¸˜",
              duration: "45",
              category: "å†’éšªæ—…éŠ",
              description: "ç™»ä¸Šå°åŠ å¸åœ‹çš„å¤±è½ä¹‹åŸï¼Œæ„Ÿå—å®‰åœ°æ–¯å±±è„ˆçš„ç¥ç§˜",
              thumbnail: "https://images.unsplash.com/photo-1587595431973-160d0d94add1?w=400&h=225&fit=crop",
              youtubeId: "QoHTSSS3DwQ"
            },
            {
              time: "16:00",
              title: "è—è¡“ä¹‹æ—… - ç¾©å¤§åˆ©ä½›ç¾…å€«æ–¯æ–‡è—å¾©èˆˆ",
              duration: "60",
              category: "è—è¡“æ—…éŠ",
              description: "åœ¨æ–‡è—å¾©èˆˆçš„ç™¼æºåœ°ï¼Œæ¬£è³ç±³é–‹æœ—åŸºç¾…èˆ‡é”æ–‡è¥¿çš„å‚‘ä½œ",
              thumbnail: "https://images.unsplash.com/photo-1552832230-c0197dd311b5?w=400&h=225&fit=crop",
              youtubeId: "BDnpjQmGRqY"
            }
          ];
        }
      }
      
      // æ›´æ–°æ—¥æœŸå’Œæ™‚é–“
      function updateDateTime() {
        const now = new Date();
        const taiwanTime = new Date(now.getTime() + (8 * 60 * 60 * 1000)); // UTC+8
        
        const month = taiwanTime.getUTCMonth() + 1;
        const date = taiwanTime.getUTCDate();
        const day = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][taiwanTime.getUTCDay()];
        const hours = String(taiwanTime.getUTCHours()).padStart(2, '0');
        const minutes = String(taiwanTime.getUTCMinutes()).padStart(2, '0');
        
        document.getElementById('currentDate').textContent = `${month}æœˆ${date}æ—¥ æ˜ŸæœŸ${day}`;
        document.getElementById('currentTime').textContent = `${hours}:${minutes}`;
      }
      
      // æ¸²æŸ“ç¯€ç›®
      function renderPrograms() {
        const carousel = document.getElementById('scheduleCarousel');
        const indicators = document.getElementById('scrollIndicators');
        
        if (!carousel || !indicators) return;
        
        // æ¸²æŸ“ç¯€ç›®å¡ç‰‡
        carousel.innerHTML = programs.map((program, index) => {
          const isCurrent = isCurrentProgram(program);
          return createProgramCard(program, index, isCurrent);
        }).join('');
        
        // æ¸²æŸ“æŒ‡ç¤ºå™¨
        indicators.innerHTML = programs.map((_, index) => 
          `<div class="indicator-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></div>`
        ).join('');
        
        // æ›´æ–°ç•¶å‰ç¯€ç›®ç´¢å¼•
        currentProgramIndex = programs.findIndex(p => isCurrentProgram(p));
        if (currentProgramIndex === -1) currentProgramIndex = 0;
        
        updateActiveIndicator();
      }
      
      // å‰µå»ºç¯€ç›®å¡ç‰‡
      function createProgramCard(program, index, isCurrent) {
        return `
          <div class="program-card ${isCurrent ? 'current' : ''}" data-index="${index}">
            <div class="program-image">
              <img src="${program.thumbnail}" alt="${program.title}" onerror="this.src='https://via.placeholder.com/320x200/000000/ffffff?text=ç¯€ç›®åœ–ç‰‡'">
              <div class="time-badge">${program.time}</div>
              ${isCurrent ? '<div class="status-badge"><span class="status-dot"></span>ç¾æ­£æ’­å‡º</div>' : ''}
              ${program.youtubeId ? '<div class="play-overlay"><button class="play-btn" data-video-id="' + program.youtubeId + '">â–¶</button></div>' : ''}
            </div>
            <div class="program-info">
              <div class="program-title">${program.title}</div>
              <div class="program-description">${program.description}</div>
              <div class="program-meta">
                <span class="category-tag">${program.category}</span>
                <div class="duration-info">
                  <span>â±</span>
                  <span>${program.duration}åˆ†é˜</span>
                </div>
              </div>
              ${program.youtubeId ? '<button class="watch-btn" data-video-id="' + program.youtubeId + '">ç«‹å³è§€çœ‹</button>' : ''}
            </div>
          </div>
        `;
      }
      
      // æª¢æŸ¥ç¯€ç›®ç‹€æ…‹
      function checkProgramStatus() {
        programs.forEach((program, index) => {
          const card = document.querySelector(`[data-index="${index}"]`);
          if (card) {
            const isCurrent = isCurrentProgram(program);
            card.classList.toggle('current', isCurrent);
            
            // æ›´æ–°ç‹€æ…‹å¾½ç« 
            const statusBadge = card.querySelector('.status-badge');
            if (isCurrent && !statusBadge) {
              const imageContainer = card.querySelector('.program-image');
              imageContainer.insertAdjacentHTML('beforeend', 
                '<div class="status-badge"><span class="status-dot"></span>ç¾æ­£æ’­å‡º</div>'
              );
            } else if (!isCurrent && statusBadge) {
              statusBadge.remove();
            }
          }
        });
        
        // æ›´æ–°ç•¶å‰ç¯€ç›®ç´¢å¼•
        currentProgramIndex = programs.findIndex(p => isCurrentProgram(p));
        if (currentProgramIndex === -1) currentProgramIndex = 0;
        
        updateActiveIndicator();
      }
      
      // åˆ¤æ–·æ˜¯å¦ç‚ºç•¶å‰ç¯€ç›®
      function isCurrentProgram(program) {
        const now = new Date();
        const taiwanTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
        const currentTime = taiwanTime.getUTCHours() * 60 + taiwanTime.getUTCMinutes();
        
        const [programHour, programMinute] = program.time.split(':').map(Number);
        const programStartTime = programHour * 60 + programMinute;
        const programEndTime = programStartTime + parseInt(program.duration);
        
        return currentTime >= programStartTime && currentTime < programEndTime;
      }
      
      // è¨­ç½®äº‹ä»¶ç›£è½å™¨
      function setupEventListeners() {
        // æ»¾å‹•ç®­é ­
        document.getElementById('scrollLeft')?.addEventListener('click', () => {
          scrollToProgram(currentProgramIndex - 1);
        });
        
        document.getElementById('scrollRight')?.addEventListener('click', () => {
          scrollToProgram(currentProgramIndex + 1);
        });
        
        // æŒ‡ç¤ºå™¨é»æ“Š
        document.getElementById('scrollIndicators')?.addEventListener('click', (e) => {
          if (e.target.classList.contains('indicator-dot')) {
            const index = parseInt(e.target.dataset.index);
            scrollToProgram(index);
          }
        });
        
        // ç¯€ç›®å¡ç‰‡é»æ“Š
        document.getElementById('scheduleCarousel')?.addEventListener('click', (e) => {
          const card = e.target.closest('.program-card');
          if (card) {
            const index = parseInt(card.dataset.index);
            const program = programs[index];
            console.log('é»æ“Šç¯€ç›®:', program.title);
            // é€™è£¡å¯ä»¥æ·»åŠ æ’­æ”¾ç¯€ç›®çš„é‚è¼¯
          }
        });

        // æ’­æ”¾æŒ‰éˆ•é»æ“Šäº‹ä»¶
        document.addEventListener('click', (e) => {
          if (e.target.classList.contains('play-btn') || e.target.classList.contains('watch-btn')) {
            e.stopPropagation();
            const videoId = e.target.getAttribute('data-video-id');
            if (videoId) {
              console.log('æ’­æ”¾å½±ç‰‡ ID:', videoId);
              openFullscreenPlayer(videoId);
            } else {
              console.error('æ‰¾ä¸åˆ°å½±ç‰‡ ID');
            }
          }
        });
      }
      
      // æ»¾å‹•åˆ°æŒ‡å®šç¯€ç›®
      function scrollToProgram(index) {
        if (index < 0) index = programs.length - 1;
        if (index >= programs.length) index = 0;
        
        const carousel = document.getElementById('scheduleCarousel');
        const card = carousel.querySelector(`[data-index="${index}"]`);
        
        if (card) {
          card.scrollIntoView({
            behavior: 'smooth',
            block: 'nearest',
            inline: 'center'
          });
          
          currentProgramIndex = index;
          updateActiveIndicator();
        }
      }
      
      // æ›´æ–°æ´»å‹•æŒ‡ç¤ºå™¨
      function updateActiveIndicator() {
        document.querySelectorAll('.indicator-dot').forEach((dot, index) => {
          dot.classList.toggle('active', index === currentProgramIndex);
        });
      }

      // === å…¨è¢å¹•æ’­æ”¾å™¨åŠŸèƒ½ ===
      let fullscreenPlayerObject = null;

      function openFullscreenPlayer(videoId) {
        console.log('openFullscreenPlayer è¢«èª¿ç”¨ï¼ŒvideoId:', videoId);
        
        const fullscreenPlayerEl = document.getElementById('fullscreenPlayer');
        if (!fullscreenPlayerEl) {
          console.error('æ‰¾ä¸åˆ° fullscreenPlayer å…ƒç´ ');
          return;
        }

        // é˜²æ­¢é é¢æ»¾å‹•
        document.body.style.overflow = 'hidden';
        
        // é¡¯ç¤ºæ’­æ”¾å™¨
        fullscreenPlayerEl.classList.add('active');
        console.log('æ’­æ”¾å™¨å®¹å™¨å·²é¡¯ç¤º');

        // å‰µå»º YouTube æ’­æ”¾å™¨
        if (window.YT && window.YT.Player) {
          console.log('YouTube API å·²è¼‰å…¥ï¼Œç›´æ¥å‰µå»ºæ’­æ”¾å™¨');
          createYouTubePlayer(videoId);
        } else {
          console.log('YouTube API æœªè¼‰å…¥ï¼Œé–‹å§‹è¼‰å…¥...');
          // å¦‚æœ YouTube API é‚„æ²’è¼‰å…¥ï¼Œå…ˆè¼‰å…¥
          loadYouTubeAPI().then(() => {
            console.log('YouTube API è¼‰å…¥æˆåŠŸ');
            createYouTubePlayer(videoId);
          }).catch(error => {
            console.error('YouTube API è¼‰å…¥å¤±æ•—:', error);
            showErrorMessage('ç„¡æ³•è¼‰å…¥å½±ç‰‡æ’­æ”¾å™¨ï¼Œè«‹ç¨å¾Œå†è©¦');
          });
        }
      }

      function createYouTubePlayer(videoId) {
        console.log('createYouTubePlayer è¢«èª¿ç”¨ï¼ŒvideoId:', videoId);
        
        const fullscreenPlayerEl = document.getElementById('fullscreenPlayer');
        const playerDiv = document.getElementById('main-player');
        
        if (!playerDiv) {
          console.error('æ‰¾ä¸åˆ° main-player å…ƒç´ ');
          return;
        }
        
        if (fullscreenPlayerObject) {
          console.log('éŠ·æ¯€ç¾æœ‰æ’­æ”¾å™¨');
          fullscreenPlayerObject.destroy();
        }

        console.log('å‰µå»ºæ–°çš„ YouTube æ’­æ”¾å™¨...');
        try {
          fullscreenPlayerObject = new YT.Player('main-player', {
            width: '100%',
            height: '100%',
            videoId: videoId,
            playerVars: {
              autoplay: 1,
              controls: 1,
              rel: 0,
              modestbranding: 1,
              fs: 1,
              enablejsapi: 1
            },
            events: {
              onReady: function(event) {
                console.log('YouTube æ’­æ”¾å™¨æº–å‚™å°±ç·’');
                event.target.setPlaybackQuality('highres');
                event.target.playVideo();
              },
              onError: function(event) {
                console.error('YouTube æ’­æ”¾å™¨éŒ¯èª¤:', event.data);
                showErrorMessage('å½±ç‰‡æ’­æ”¾å¤±æ•—ï¼Œè«‹æª¢æŸ¥å½±ç‰‡ ID æ˜¯å¦æ­£ç¢º');
              }
            }
          });
          console.log('YouTube æ’­æ”¾å™¨å‰µå»ºæˆåŠŸ');
        } catch (error) {
          console.error('å‰µå»º YouTube æ’­æ”¾å™¨æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
          showErrorMessage('æ’­æ”¾å™¨å‰µå»ºå¤±æ•—: ' + error.message);
        }
      }

      function loadYouTubeAPI() {
        return new Promise((resolve, reject) => {
          console.log('loadYouTubeAPI è¢«èª¿ç”¨');
          
          if (window.YT && window.YT.Player) {
            console.log('YouTube API å·²ç¶“è¼‰å…¥');
            resolve();
            return;
          }

          console.log('é–‹å§‹è¼‰å…¥ YouTube IFrame API...');
          
          // è¼‰å…¥ YouTube IFrame API
          const tag = document.createElement('script');
          tag.src = 'https://www.youtube.com/iframe_api';
          const firstScriptTag = document.getElementsByTagName('script')[0];
          firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

          // è¨­å®šå…¨åŸŸå›èª¿
          window.onYouTubeIframeAPIReady = function() {
            console.log('YouTube API è¼‰å…¥å®Œæˆ');
            resolve();
          };

          // è¨­å®šè¶…æ™‚
          setTimeout(() => {
            console.error('YouTube API è¼‰å…¥è¶…æ™‚');
            reject(new Error('YouTube API è¼‰å…¥è¶…æ™‚'));
          }, 10000);
        });
      }

      function closeFullscreenPlayer() {
        const fullscreenPlayerEl = document.getElementById('fullscreenPlayer');
        if (!fullscreenPlayerEl) return;

        // æ¢å¾©é é¢æ»¾å‹•
        document.body.style.overflow = '';
        
        // éš±è—æ’­æ”¾å™¨
        fullscreenPlayerEl.classList.remove('active');

        // éŠ·æ¯€æ’­æ”¾å™¨
        if (fullscreenPlayerObject) {
          fullscreenPlayerObject.destroy();
          fullscreenPlayerObject = null;
        }
      }

      function showErrorMessage(message) {
        // ç°¡å–®çš„éŒ¯èª¤è¨Šæ¯é¡¯ç¤º
        alert(message);
        closeFullscreenPlayer();
      }

      // é—œé–‰æŒ‰éˆ•äº‹ä»¶ç›£è½
      document.addEventListener('click', function(e) {
        if (e.target && e.target.classList.contains('close-player-btn')) {
          closeFullscreenPlayer();
        }
      });

      // ESC éµé—œé–‰æ’­æ”¾å™¨
      window.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeFullscreenPlayer();
        }
      });

      // é»æ“Šæ’­æ”¾å™¨èƒŒæ™¯é—œé–‰
      document.getElementById('fullscreenPlayer')?.addEventListener('click', function(e) {
        if (e.target === this) {
          closeFullscreenPlayer();
        }
      });

      // æ¸¬è©¦æ’­æ”¾åŠŸèƒ½
      window.testPlayback = function() {
        console.log('æ¸¬è©¦æ’­æ”¾åŠŸèƒ½');
        const testVideoId = '3GZCJfIOg_k'; // ä½¿ç”¨é è¨­çš„æ¸¬è©¦å½±ç‰‡ ID
        openFullscreenPlayer(testVideoId);
      };
    });
  </script>

  <!-- å…¨è¢å¹•æ’­æ”¾å™¨ -->
  <div class="fullscreen-player" id="fullscreenPlayer">
    <button class="close-player-btn" title="é—œé–‰æ’­æ”¾å™¨">&times;</button>
    <div id="main-player"></div>
  </div>
</body>
</html>
