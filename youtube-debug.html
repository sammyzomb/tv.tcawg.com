<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube 自動抓取功能測試</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
    .status-bar { position: fixed; bottom: 20px; right: 20px; background: #333; color: white; padding: 15px 20px; border-radius: 8px; display: none; }
    .debug-info { background: #f5f5f5; padding: 15px; border-radius: 5px; margin-top: 20px; }
    .debug-info h3 { margin-top: 0; }
    .debug-info pre { background: white; padding: 10px; border-radius: 3px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>YouTube 自動抓取功能測試</h1>
  
  <div class="form-group">
    <label>影片類型：</label>
    <select id="videoType" onchange="toggleVideoFields()">
      <option value="">-- 選擇影片類型 --</option>
      <option value="YouTube">YouTube</option>
      <option value="MP4">MP4 檔案</option>
    </select>
  </div>

  <div class="form-group" id="youtubeIdGroup" style="display: none;">
    <label>YouTube ID：</label>
    <input type="text" id="youtubeId" placeholder="例如：dQw4w9WgXcQ" onblur="fetchYouTubeInfo()" oninput="updateThumbnailPreview(this.value.trim())">
    <small>輸入 YouTube ID 後點擊其他地方觸發自動抓取</small>
  </div>

  <div class="form-group">
    <label>節目標題：</label>
    <input type="text" id="title" placeholder="自動填入的標題會顯示在這裡">
  </div>

  <div class="form-group">
    <label>縮圖預覽：</label>
    <img id="thumbnailPreview" src="https://images.unsplash.com/photo-1485846234645-a62644f84728?w=200&h=112&fit=crop" 
         style="width: 200px; height: 112px; object-fit: cover; border: 2px solid #007bff; border-radius: 8px;">
  </div>

  <div class="debug-info">
    <h3>調試資訊</h3>
    <div id="debugLog"></div>
  </div>

  <div class="status-bar" id="statusBar">
    <span id="statusMessage"></span>
  </div>

  <script>
    function log(message) {
      const debugLog = document.getElementById('debugLog');
      const timestamp = new Date().toLocaleTimeString();
      debugLog.innerHTML += `<div>[${timestamp}] ${message}</div>`;
      console.log(`[${timestamp}] ${message}`);
    }

    function toggleVideoFields() {
      const videoType = document.getElementById('videoType').value;
      const youtubeIdGroup = document.getElementById('youtubeIdGroup');
      const mp4FileGroup = document.getElementById('mp4FileGroup');

      log(`切換影片類型: ${videoType}`);
      
      youtubeIdGroup.style.display = videoType === 'YouTube' ? 'block' : 'none';
      if (mp4FileGroup) {
        mp4FileGroup.style.display = videoType === 'MP4' ? 'block' : 'none';
      }
    }

    async function fetchYouTubeInfo() {
      const youtubeId = document.getElementById('youtubeId').value.trim();
      log(`開始抓取 YouTube 資訊，ID: ${youtubeId}`);
      
      if (!youtubeId) {
        log('YouTube ID 為空，跳過抓取');
        return;
      }

      try {
        const url = `https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${youtubeId}&format=json`;
        log(`請求 URL: ${url}`);
        
        const response = await fetch(url);
        log(`回應狀態: ${response.status} ${response.statusText}`);
        
        if (response.ok) {
          const data = await response.json();
          log(`成功獲取資料: ${JSON.stringify(data, null, 2)}`);
          
          document.getElementById('title').value = data.title;
          log(`已設定標題: ${data.title}`);
          
          // 自動更新縮圖預覽
          updateThumbnailPreview(youtubeId);
          
          showStatus('YouTube 資訊已自動填入', 'success');
        } else {
          log(`API 回應錯誤: ${response.status}`);
          showStatus('無法獲取 YouTube 資訊，請檢查 ID 是否正確', 'warning');
        }
      } catch (error) {
        log(`抓取時發生錯誤: ${error.message}`);
        showStatus('獲取 YouTube 資訊時發生錯誤', 'error');
      }
    }

    // 更新縮圖預覽
    function updateThumbnailPreview(youtubeId) {
      const thumbnailPreview = document.getElementById('thumbnailPreview');
      if (youtubeId) {
        const thumbnailUrl = `https://img.youtube.com/vi/${youtubeId}/maxresdefault.jpg`;
        thumbnailPreview.src = thumbnailUrl;
        log(`更新縮圖: ${thumbnailUrl}`);
      } else {
        thumbnailPreview.src = 'https://images.unsplash.com/photo-1485846234645-a62644f84728?w=200&h=112&fit=crop';
        log('清除縮圖');
      }
    }

    function showStatus(message, type) {
      const statusBar = document.getElementById('statusBar');
      const statusMessage = document.getElementById('statusMessage');

      log(`狀態訊息: ${message} (類型: ${type})`);

      statusMessage.textContent = message;
      statusBar.style.display = 'block';

      statusBar.style.backgroundColor = type === 'success' ? '#4caf50' : 
                                       type === 'error' ? '#f44336' : 
                                       type === 'warning' ? '#ff9800' : '#333';

      setTimeout(() => {
        statusBar.style.display = 'none';
      }, 3000);
    }

    // 頁面載入完成後的初始化
    document.addEventListener('DOMContentLoaded', function() {
      log('頁面載入完成，開始測試');
    });
  </script>
</body>
</html>



