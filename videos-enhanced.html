<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>所有節目｜航向世界旅遊頻道</title>

  <!-- 站內樣式 -->
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="favicon.png" type="image/png">

  <!-- 必要套件：Contentful + Twemoji -->
  <script src="https://cdn.jsdelivr.net/npm/contentful@latest/dist/contentful.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js" crossorigin="anonymous"></script>

  <!-- 歸檔系統 -->
  <script src="archive-system.js"></script>

  <!-- 本頁樣式 -->
  <style>
    :root{ --bg:#ffffff; --text:#111827; --card:#ffffff; --card-border:rgba(0,0,0,.06); --accent:#e0b46a; --active-bg:#f6f6f6; }
    .dark-theme{ --bg:#0b1620; --text:#e5eef9; --card:#0f2133; --card-border:rgba(255,255,255,.08); --active-bg:#0f2133; }
    body{ background:var(--bg); color:var(--text); margin:0; }

    .page-wrap { max-width: 1400px; margin: 0 auto; padding: 24px 5%; }
    .page-head { display:flex; align-items:center; gap:12px; margin: 8px 0 16px; }
    .page-head h1 { font-weight:900; font-size:28px; margin:0; }
    .hint { color:#8aa4c2; font-size:14px; }

    /* 篩選器面板 */
    .filter-panel {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-group label {
      font-weight: 600;
      font-size: 14px;
      color: var(--text);
    }

    .filter-group select,
    .filter-group input {
      padding: 8px 12px;
      border: 1px solid var(--card-border);
      border-radius: 6px;
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
    }

    .filter-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: #d4a55a;
    }

    .btn-secondary {
      background: var(--card-border);
      color: var(--text);
    }

    .btn-secondary:hover {
      background: var(--active-bg);
    }

    /* 統計面板 */
    .stats-panel {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 16px;
    }

    .stat-item {
      text-align: center;
      padding: 16px;
      background: var(--active-bg);
      border-radius: 8px;
    }

    .stat-number {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 12px;
      color: var(--text);
      opacity: 0.7;
    }

    /* 節目卡片網格 */
    .programs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .program-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
    }

    .program-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }

    .program-thumbnail {
      position: relative;
      width: 100%;
      height: 180px;
      overflow: hidden;
    }

    .program-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .program-duration {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .program-info {
      padding: 16px;
    }

    .program-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 8px 0;
      line-height: 1.4;
      color: var(--text);
    }

    .program-meta {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      font-size: 12px;
      color: var(--text);
      opacity: 0.7;
    }

    .program-stats {
      display: flex;
      gap: 16px;
      margin-bottom: 12px;
      font-size: 12px;
    }

    .program-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .tag {
      background: var(--accent);
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }

    /* 排序控制 */
    .sort-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .sort-select {
      padding: 6px 12px;
      border: 1px solid var(--card-border);
      border-radius: 6px;
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
    }

    .results-count {
      font-size: 14px;
      color: var(--text);
      opacity: 0.7;
    }

    /* 載入狀態 */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text);
      opacity: 0.7;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text);
      opacity: 0.7;
    }

    .empty-state h3 {
      margin-bottom: 8px;
      font-size: 18px;
    }

    .empty-state p {
      font-size: 14px;
    }

    /* 響應式設計 */
    @media (max-width: 768px) {
      .filter-grid {
        grid-template-columns: 1fr;
      }
      
      .programs-grid {
        grid-template-columns: 1fr;
      }
      
      .sort-controls {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <!-- 導航欄 -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <img src="logo.png" alt="航向世界旅遊頻道" class="nav-logo">
        <span class="nav-title">航向世界旅遊頻道</span>
      </div>
      <div class="nav-menu">
        <a href="index.html" class="nav-link">
          <span class="nav-icon">🏠</span>
          <span class="nav-text">首頁</span>
        </a>
        <a href="videos-enhanced.html" class="nav-link active">
          <span class="nav-icon">📺</span>
          <span class="nav-text">所有節目</span>
        </a>
        <a href="schedule.html" class="nav-link">
          <span class="nav-icon">📅</span>
          <span class="nav-text">節目表</span>
        </a>
        <a href="admin-login.html" class="nav-link">
          <span class="nav-icon">🔐</span>
          <span class="nav-text">會員登入</span>
        </a>
      </div>
      <button id="hamburger-btn" class="hamburger-btn">
        <svg viewBox="0 0 100 80" width="24" height="24">
          <rect width="100" height="15" rx="8"></rect>
          <rect y="30" width="100" height="15" rx="8"></rect>
          <rect y="60" width="100" height="15" rx="8"></rect>
        </svg>
      </button>
    </div>
  </nav>

  <div id="side-menu" class="side-menu">
    <a href="index.html">首頁</a>
    <a href="videos-enhanced.html">所有節目</a>
    <a href="schedule.html">節目表</a>
    <a href="admin-login.html">會員登入</a>
  </div>
  <div id="menu-overlay" class="menu-overlay"></div>

  <!-- 內容區 -->
  <main class="page-wrap">
    <div class="page-head">
      <h1>📺 所有節目</h1>
      <span class="hint">已歸檔的節目，支援多維度篩選和分類瀏覽</span>
    </div>

    <!-- 統計面板 -->
    <div class="stats-panel">
      <h3 style="margin: 0 0 16px 0; font-size: 18px;">📊 節目統計</h3>
      <div id="archive-stats" class="stats-grid">
        <div class="loading">載入統計中...</div>
      </div>
    </div>

    <!-- 篩選器面板 -->
    <div class="filter-panel">
      <h3 style="margin: 0 0 16px 0; font-size: 18px;">🔍 篩選節目</h3>
      
      <div class="filter-grid">
        <div class="filter-group">
          <label>國家/地區</label>
          <select id="country-filter">
            <option value="">全部國家</option>
            <option value="日本">日本</option>
            <option value="韓國">韓國</option>
            <option value="泰國">泰國</option>
            <option value="越南">越南</option>
            <option value="新加坡">新加坡</option>
            <option value="馬來西亞">馬來西亞</option>
            <option value="印尼">印尼</option>
            <option value="法國">法國</option>
            <option value="義大利">義大利</option>
            <option value="德國">德國</option>
            <option value="英國">英國</option>
            <option value="西班牙">西班牙</option>
            <option value="美國">美國</option>
            <option value="加拿大">加拿大</option>
            <option value="澳洲">澳洲</option>
            <option value="紐西蘭">紐西蘭</option>
            <option value="其他">其他</option>
          </select>
        </div>

        <div class="filter-group">
          <label>節目分類</label>
          <select id="category-filter">
            <option value="">全部分類</option>
            <option value="亞洲旅遊">亞洲旅遊</option>
            <option value="歐洲旅遊">歐洲旅遊</option>
            <option value="美洲旅遊">美洲旅遊</option>
            <option value="美食旅遊">美食旅遊</option>
            <option value="極地旅遊">極地旅遊</option>
            <option value="自然旅遊">自然旅遊</option>
            <option value="文化旅遊">文化旅遊</option>
            <option value="冒險旅遊">冒險旅遊</option>
            <option value="其他">其他</option>
          </select>
        </div>

        <div class="filter-group">
          <label>子分類</label>
          <select id="subcategory-filter">
            <option value="">全部子分類</option>
            <option value="美食">美食</option>
            <option value="文化">文化</option>
            <option value="自然">自然</option>
            <option value="藝術">藝術</option>
            <option value="海洋">海洋</option>
            <option value="溫泉">溫泉</option>
            <option value="節慶">節慶</option>
            <option value="購物">購物</option>
            <option value="冒險">冒險</option>
            <option value="其他">其他</option>
          </select>
        </div>

        <div class="filter-group">
          <label>播出週別</label>
          <select id="week-filter">
            <option value="">全部週別</option>
            <!-- 動態生成週別選項 -->
          </select>
        </div>

        <div class="filter-group">
          <label>最低評分</label>
          <select id="rating-filter">
            <option value="0">全部評分</option>
            <option value="1">1星以上</option>
            <option value="2">2星以上</option>
            <option value="3">3星以上</option>
            <option value="4">4星以上</option>
            <option value="5">5星</option>
          </select>
        </div>

        <div class="filter-group">
          <label>節目狀態</label>
          <select id="status-filter">
            <option value="">全部狀態</option>
            <option value="archived">已歸檔</option>
            <option value="popular">熱門</option>
            <option value="recommended">推薦</option>
          </select>
        </div>
      </div>

      <div class="filter-actions">
        <button class="btn btn-primary" onclick="applyFilters()">套用篩選</button>
        <button class="btn btn-secondary" onclick="clearFilters()">清除篩選</button>
        <span id="results-count" class="results-count"></span>
      </div>
    </div>

    <!-- 排序控制 -->
    <div class="sort-controls">
      <div>
        <label for="sort-select">排序方式：</label>
        <select id="sort-select" class="sort-select" onchange="updateSort()">
          <option value="airDate-desc">播出日期（最新）</option>
          <option value="airDate-asc">播出日期（最舊）</option>
          <option value="rating-desc">評分（最高）</option>
          <option value="rating-asc">評分（最低）</option>
          <option value="viewCount-desc">觀看次數（最多）</option>
          <option value="viewCount-asc">觀看次數（最少）</option>
          <option value="favoriteCount-desc">收藏數（最多）</option>
          <option value="favoriteCount-asc">收藏數（最少）</option>
        </select>
      </div>
    </div>

    <!-- 節目列表 -->
    <div id="archived-programs" class="programs-grid">
      <div class="loading">載入節目中...</div>
    </div>
  </main>

  <!-- 站內 JS -->
  <script src="script.js"></script>

  <!-- 本頁邏輯 -->
  <script>
    (function(){
      'use strict';

      // 初始化 Contentful
      const client = contentful.createClient({
        space: 'your-space-id', // 請替換為您的 Space ID
        accessToken: 'your-access-token' // 請替換為您的 Access Token
      });

      // 初始化歸檔系統
      async function initArchiveSystem() {
        try {
          await window.programArchiveSystem.init(client);
          window.programArchiveSystem.updateDisplay();
          updateResultsCount();
        } catch (error) {
          console.error('初始化歸檔系統失敗:', error);
          document.getElementById('archived-programs').innerHTML = 
            '<div class="empty-state"><h3>載入失敗</h3><p>請檢查網路連線或稍後再試</p></div>';
        }
      }

      // 套用篩選
      window.applyFilters = function() {
        const filters = {
          country: document.getElementById('country-filter').value,
          category: document.getElementById('category-filter').value,
          subCategory: document.getElementById('subcategory-filter').value,
          week: document.getElementById('week-filter').value,
          rating: parseInt(document.getElementById('rating-filter').value),
          status: document.getElementById('status-filter').value
        };

        window.programArchiveSystem.filterPrograms(filters);
        window.programArchiveSystem.updateDisplay();
        updateResultsCount();
      };

      // 清除篩選
      window.clearFilters = function() {
        document.getElementById('country-filter').value = '';
        document.getElementById('category-filter').value = '';
        document.getElementById('subcategory-filter').value = '';
        document.getElementById('week-filter').value = '';
        document.getElementById('rating-filter').value = '0';
        document.getElementById('status-filter').value = '';

        window.programArchiveSystem.filterPrograms({});
        window.programArchiveSystem.updateDisplay();
        updateResultsCount();
      };

      // 更新排序
      window.updateSort = function() {
        const sortValue = document.getElementById('sort-select').value;
        const [sortBy, order] = sortValue.split('-');
        
        window.programArchiveSystem.sortPrograms(
          window.programArchiveSystem.archivedPrograms, 
          sortBy, 
          order
        );
        window.programArchiveSystem.updateDisplay();
      };

      // 更新結果數量
      function updateResultsCount() {
        const filteredCount = window.programArchiveSystem.filterPrograms().length;
        const totalCount = window.programArchiveSystem.archivedPrograms.length;
        document.getElementById('results-count').textContent = 
          `顯示 ${filteredCount} 個節目（共 ${totalCount} 個）`;
      }

      // 生成週別選項
      function generateWeekOptions() {
        const weekSelect = document.getElementById('week-filter');
        const currentYear = new Date().getFullYear();
        
        for (let year = currentYear; year >= currentYear - 2; year--) {
          for (let week = 1; week <= 52; week++) {
            const weekStr = `${year}-W${week.toString().padStart(2, '0')}`;
            const option = document.createElement('option');
            option.value = weekStr;
            option.textContent = `${year}年第${week}週`;
            weekSelect.appendChild(option);
          }
        }
      }

      // 節目卡片點擊事件
      document.addEventListener('click', function(e) {
        if (e.target.closest('.program-card')) {
          const card = e.target.closest('.program-card');
          const programId = card.dataset.id;
          const program = window.programArchiveSystem.archivedPrograms.find(p => p.id === programId);
          
          if (program && program.videoId) {
            // 跳轉到影片播放頁面
            window.open(`video.html?id=${program.videoId}`, '_blank');
          }
        }
      });

      // 頁面載入完成後初始化
      document.addEventListener('DOMContentLoaded', function() {
        generateWeekOptions();
        initArchiveSystem();
      });

    })();
  </script>
</body>
</html>
