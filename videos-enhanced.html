<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ‰€æœ‰ç¯€ç›®ï½œèˆªå‘ä¸–ç•Œæ—…éŠé »é“</title>

  <!-- ç«™å…§æ¨£å¼ -->
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="favicon.png" type="image/png">

  <!-- å¿…è¦å¥—ä»¶ï¼šContentful + Twemoji -->
  <script src="https://cdn.jsdelivr.net/npm/contentful@latest/dist/contentful.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js" crossorigin="anonymous"></script>

  <!-- æ­¸æª”ç³»çµ± -->
  <script src="archive-system.js"></script>

  <!-- æœ¬é æ¨£å¼ -->
  <style>
    :root{ --bg:#ffffff; --text:#111827; --card:#ffffff; --card-border:rgba(0,0,0,.06); --accent:#e0b46a; --active-bg:#f6f6f6; }
    .dark-theme{ --bg:#0b1620; --text:#e5eef9; --card:#0f2133; --card-border:rgba(255,255,255,.08); --active-bg:#0f2133; }
    body{ background:var(--bg); color:var(--text); margin:0; }

    .page-wrap { max-width: 1400px; margin: 0 auto; padding: 24px 5%; }
    .page-head { display:flex; align-items:center; gap:12px; margin: 8px 0 16px; }
    .page-head h1 { font-weight:900; font-size:28px; margin:0; }
    .hint { color:#8aa4c2; font-size:14px; }

    /* ç¯©é¸å™¨é¢æ¿ */
    .filter-panel {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-group label {
      font-weight: 600;
      font-size: 14px;
      color: var(--text);
    }

    .filter-group select,
    .filter-group input {
      padding: 8px 12px;
      border: 1px solid var(--card-border);
      border-radius: 6px;
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
    }

    .filter-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: #d4a55a;
    }

    .btn-secondary {
      background: var(--card-border);
      color: var(--text);
    }

    .btn-secondary:hover {
      background: var(--active-bg);
    }

    /* çµ±è¨ˆé¢æ¿ */
    .stats-panel {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 16px;
    }

    .stat-item {
      text-align: center;
      padding: 16px;
      background: var(--active-bg);
      border-radius: 8px;
    }

    .stat-number {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 12px;
      color: var(--text);
      opacity: 0.7;
    }

    /* ç¯€ç›®å¡ç‰‡ç¶²æ ¼ */
    .programs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .program-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
    }

    .program-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }

    .program-thumbnail {
      position: relative;
      width: 100%;
      height: 180px;
      overflow: hidden;
    }

    .program-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .program-duration {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .program-info {
      padding: 16px;
    }

    .program-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 8px 0;
      line-height: 1.4;
      color: var(--text);
    }

    .program-meta {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      font-size: 12px;
      color: var(--text);
      opacity: 0.7;
    }

    .program-stats {
      display: flex;
      gap: 16px;
      margin-bottom: 12px;
      font-size: 12px;
    }

    .program-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .tag {
      background: var(--accent);
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }

    /* æ’åºæ§åˆ¶ */
    .sort-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .sort-select {
      padding: 6px 12px;
      border: 1px solid var(--card-border);
      border-radius: 6px;
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
    }

    .results-count {
      font-size: 14px;
      color: var(--text);
      opacity: 0.7;
    }

    /* è¼‰å…¥ç‹€æ…‹ */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text);
      opacity: 0.7;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text);
      opacity: 0.7;
    }

    .empty-state h3 {
      margin-bottom: 8px;
      font-size: 18px;
    }

    .empty-state p {
      font-size: 14px;
    }

    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
      .filter-grid {
        grid-template-columns: 1fr;
      }
      
      .programs-grid {
        grid-template-columns: 1fr;
      }
      
      .sort-controls {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <!-- å°èˆªæ¬„ -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <img src="logo.png" alt="èˆªå‘ä¸–ç•Œæ—…éŠé »é“" class="nav-logo">
        <span class="nav-title">èˆªå‘ä¸–ç•Œæ—…éŠé »é“</span>
      </div>
      <div class="nav-menu">
        <a href="index.html" class="nav-link">
          <span class="nav-icon">ğŸ </span>
          <span class="nav-text">é¦–é </span>
        </a>
        <a href="videos-enhanced.html" class="nav-link active">
          <span class="nav-icon">ğŸ“º</span>
          <span class="nav-text">æ‰€æœ‰ç¯€ç›®</span>
        </a>
        <a href="schedule.html" class="nav-link">
          <span class="nav-icon">ğŸ“…</span>
          <span class="nav-text">ç¯€ç›®è¡¨</span>
        </a>
        <a href="admin-login.html" class="nav-link">
          <span class="nav-icon">ğŸ”</span>
          <span class="nav-text">æœƒå“¡ç™»å…¥</span>
        </a>
      </div>
      <button id="hamburger-btn" class="hamburger-btn">
        <svg viewBox="0 0 100 80" width="24" height="24">
          <rect width="100" height="15" rx="8"></rect>
          <rect y="30" width="100" height="15" rx="8"></rect>
          <rect y="60" width="100" height="15" rx="8"></rect>
        </svg>
      </button>
    </div>
  </nav>

  <div id="side-menu" class="side-menu">
    <a href="index.html">é¦–é </a>
    <a href="videos-enhanced.html">æ‰€æœ‰ç¯€ç›®</a>
    <a href="schedule.html">ç¯€ç›®è¡¨</a>
    <a href="admin-login.html">æœƒå“¡ç™»å…¥</a>
  </div>
  <div id="menu-overlay" class="menu-overlay"></div>

  <!-- å…§å®¹å€ -->
  <main class="page-wrap">
    <div class="page-head">
      <h1>ğŸ“º æ‰€æœ‰ç¯€ç›®</h1>
      <span class="hint">å·²æ­¸æª”çš„ç¯€ç›®ï¼Œæ”¯æ´å¤šç¶­åº¦ç¯©é¸å’Œåˆ†é¡ç€è¦½</span>
    </div>

    <!-- çµ±è¨ˆé¢æ¿ -->
    <div class="stats-panel">
      <h3 style="margin: 0 0 16px 0; font-size: 18px;">ğŸ“Š ç¯€ç›®çµ±è¨ˆ</h3>
      <div id="archive-stats" class="stats-grid">
        <div class="loading">è¼‰å…¥çµ±è¨ˆä¸­...</div>
      </div>
    </div>

    <!-- ç¯©é¸å™¨é¢æ¿ -->
    <div class="filter-panel">
      <h3 style="margin: 0 0 16px 0; font-size: 18px;">ğŸ” ç¯©é¸ç¯€ç›®</h3>
      
      <div class="filter-grid">
        <div class="filter-group">
          <label>åœ‹å®¶/åœ°å€</label>
          <select id="country-filter">
            <option value="">å…¨éƒ¨åœ‹å®¶</option>
            <option value="æ—¥æœ¬">æ—¥æœ¬</option>
            <option value="éŸ“åœ‹">éŸ“åœ‹</option>
            <option value="æ³°åœ‹">æ³°åœ‹</option>
            <option value="è¶Šå—">è¶Šå—</option>
            <option value="æ–°åŠ å¡">æ–°åŠ å¡</option>
            <option value="é¦¬ä¾†è¥¿äº">é¦¬ä¾†è¥¿äº</option>
            <option value="å°å°¼">å°å°¼</option>
            <option value="æ³•åœ‹">æ³•åœ‹</option>
            <option value="ç¾©å¤§åˆ©">ç¾©å¤§åˆ©</option>
            <option value="å¾·åœ‹">å¾·åœ‹</option>
            <option value="è‹±åœ‹">è‹±åœ‹</option>
            <option value="è¥¿ç­ç‰™">è¥¿ç­ç‰™</option>
            <option value="ç¾åœ‹">ç¾åœ‹</option>
            <option value="åŠ æ‹¿å¤§">åŠ æ‹¿å¤§</option>
            <option value="æ¾³æ´²">æ¾³æ´²</option>
            <option value="ç´è¥¿è˜­">ç´è¥¿è˜­</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>

        <div class="filter-group">
          <label>ç¯€ç›®åˆ†é¡</label>
          <select id="category-filter">
            <option value="">å…¨éƒ¨åˆ†é¡</option>
            <option value="äºæ´²æ—…éŠ">äºæ´²æ—…éŠ</option>
            <option value="æ­æ´²æ—…éŠ">æ­æ´²æ—…éŠ</option>
            <option value="ç¾æ´²æ—…éŠ">ç¾æ´²æ—…éŠ</option>
            <option value="ç¾é£Ÿæ—…éŠ">ç¾é£Ÿæ—…éŠ</option>
            <option value="æ¥µåœ°æ—…éŠ">æ¥µåœ°æ—…éŠ</option>
            <option value="è‡ªç„¶æ—…éŠ">è‡ªç„¶æ—…éŠ</option>
            <option value="æ–‡åŒ–æ—…éŠ">æ–‡åŒ–æ—…éŠ</option>
            <option value="å†’éšªæ—…éŠ">å†’éšªæ—…éŠ</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>

        <div class="filter-group">
          <label>å­åˆ†é¡</label>
          <select id="subcategory-filter">
            <option value="">å…¨éƒ¨å­åˆ†é¡</option>
            <option value="ç¾é£Ÿ">ç¾é£Ÿ</option>
            <option value="æ–‡åŒ–">æ–‡åŒ–</option>
            <option value="è‡ªç„¶">è‡ªç„¶</option>
            <option value="è—è¡“">è—è¡“</option>
            <option value="æµ·æ´‹">æµ·æ´‹</option>
            <option value="æº«æ³‰">æº«æ³‰</option>
            <option value="ç¯€æ…¶">ç¯€æ…¶</option>
            <option value="è³¼ç‰©">è³¼ç‰©</option>
            <option value="å†’éšª">å†’éšª</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>

        <div class="filter-group">
          <label>æ’­å‡ºé€±åˆ¥</label>
          <select id="week-filter">
            <option value="">å…¨éƒ¨é€±åˆ¥</option>
            <!-- å‹•æ…‹ç”Ÿæˆé€±åˆ¥é¸é … -->
          </select>
        </div>

        <div class="filter-group">
          <label>æœ€ä½è©•åˆ†</label>
          <select id="rating-filter">
            <option value="0">å…¨éƒ¨è©•åˆ†</option>
            <option value="1">1æ˜Ÿä»¥ä¸Š</option>
            <option value="2">2æ˜Ÿä»¥ä¸Š</option>
            <option value="3">3æ˜Ÿä»¥ä¸Š</option>
            <option value="4">4æ˜Ÿä»¥ä¸Š</option>
            <option value="5">5æ˜Ÿ</option>
          </select>
        </div>

        <div class="filter-group">
          <label>ç¯€ç›®ç‹€æ…‹</label>
          <select id="status-filter">
            <option value="">å…¨éƒ¨ç‹€æ…‹</option>
            <option value="archived">å·²æ­¸æª”</option>
            <option value="popular">ç†±é–€</option>
            <option value="recommended">æ¨è–¦</option>
          </select>
        </div>
      </div>

      <div class="filter-actions">
        <button class="btn btn-primary" onclick="applyFilters()">å¥—ç”¨ç¯©é¸</button>
        <button class="btn btn-secondary" onclick="clearFilters()">æ¸…é™¤ç¯©é¸</button>
        <span id="results-count" class="results-count"></span>
      </div>
    </div>

    <!-- æ’åºæ§åˆ¶ -->
    <div class="sort-controls">
      <div>
        <label for="sort-select">æ’åºæ–¹å¼ï¼š</label>
        <select id="sort-select" class="sort-select" onchange="updateSort()">
          <option value="airDate-desc">æ’­å‡ºæ—¥æœŸï¼ˆæœ€æ–°ï¼‰</option>
          <option value="airDate-asc">æ’­å‡ºæ—¥æœŸï¼ˆæœ€èˆŠï¼‰</option>
          <option value="rating-desc">è©•åˆ†ï¼ˆæœ€é«˜ï¼‰</option>
          <option value="rating-asc">è©•åˆ†ï¼ˆæœ€ä½ï¼‰</option>
          <option value="viewCount-desc">è§€çœ‹æ¬¡æ•¸ï¼ˆæœ€å¤šï¼‰</option>
          <option value="viewCount-asc">è§€çœ‹æ¬¡æ•¸ï¼ˆæœ€å°‘ï¼‰</option>
          <option value="favoriteCount-desc">æ”¶è—æ•¸ï¼ˆæœ€å¤šï¼‰</option>
          <option value="favoriteCount-asc">æ”¶è—æ•¸ï¼ˆæœ€å°‘ï¼‰</option>
        </select>
      </div>
    </div>

    <!-- ç¯€ç›®åˆ—è¡¨ -->
    <div id="archived-programs" class="programs-grid">
      <div class="loading">è¼‰å…¥ç¯€ç›®ä¸­...</div>
    </div>
  </main>

  <!-- ç«™å…§ JS -->
  <script src="script.js"></script>

  <!-- æœ¬é é‚è¼¯ -->
  <script>
    (function(){
      'use strict';

      // åˆå§‹åŒ– Contentful
      const client = contentful.createClient({
        space: 'your-space-id', // è«‹æ›¿æ›ç‚ºæ‚¨çš„ Space ID
        accessToken: 'your-access-token' // è«‹æ›¿æ›ç‚ºæ‚¨çš„ Access Token
      });

      // åˆå§‹åŒ–æ­¸æª”ç³»çµ±
      async function initArchiveSystem() {
        try {
          await window.programArchiveSystem.init(client);
          window.programArchiveSystem.updateDisplay();
          updateResultsCount();
        } catch (error) {
          console.error('åˆå§‹åŒ–æ­¸æª”ç³»çµ±å¤±æ•—:', error);
          document.getElementById('archived-programs').innerHTML = 
            '<div class="empty-state"><h3>è¼‰å…¥å¤±æ•—</h3><p>è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦</p></div>';
        }
      }

      // å¥—ç”¨ç¯©é¸
      window.applyFilters = function() {
        const filters = {
          country: document.getElementById('country-filter').value,
          category: document.getElementById('category-filter').value,
          subCategory: document.getElementById('subcategory-filter').value,
          week: document.getElementById('week-filter').value,
          rating: parseInt(document.getElementById('rating-filter').value),
          status: document.getElementById('status-filter').value
        };

        window.programArchiveSystem.filterPrograms(filters);
        window.programArchiveSystem.updateDisplay();
        updateResultsCount();
      };

      // æ¸…é™¤ç¯©é¸
      window.clearFilters = function() {
        document.getElementById('country-filter').value = '';
        document.getElementById('category-filter').value = '';
        document.getElementById('subcategory-filter').value = '';
        document.getElementById('week-filter').value = '';
        document.getElementById('rating-filter').value = '0';
        document.getElementById('status-filter').value = '';

        window.programArchiveSystem.filterPrograms({});
        window.programArchiveSystem.updateDisplay();
        updateResultsCount();
      };

      // æ›´æ–°æ’åº
      window.updateSort = function() {
        const sortValue = document.getElementById('sort-select').value;
        const [sortBy, order] = sortValue.split('-');
        
        window.programArchiveSystem.sortPrograms(
          window.programArchiveSystem.archivedPrograms, 
          sortBy, 
          order
        );
        window.programArchiveSystem.updateDisplay();
      };

      // æ›´æ–°çµæœæ•¸é‡
      function updateResultsCount() {
        const filteredCount = window.programArchiveSystem.filterPrograms().length;
        const totalCount = window.programArchiveSystem.archivedPrograms.length;
        document.getElementById('results-count').textContent = 
          `é¡¯ç¤º ${filteredCount} å€‹ç¯€ç›®ï¼ˆå…± ${totalCount} å€‹ï¼‰`;
      }

      // ç”Ÿæˆé€±åˆ¥é¸é …
      function generateWeekOptions() {
        const weekSelect = document.getElementById('week-filter');
        const currentYear = new Date().getFullYear();
        
        for (let year = currentYear; year >= currentYear - 2; year--) {
          for (let week = 1; week <= 52; week++) {
            const weekStr = `${year}-W${week.toString().padStart(2, '0')}`;
            const option = document.createElement('option');
            option.value = weekStr;
            option.textContent = `${year}å¹´ç¬¬${week}é€±`;
            weekSelect.appendChild(option);
          }
        }
      }

      // ç¯€ç›®å¡ç‰‡é»æ“Šäº‹ä»¶
      document.addEventListener('click', function(e) {
        if (e.target.closest('.program-card')) {
          const card = e.target.closest('.program-card');
          const programId = card.dataset.id;
          const program = window.programArchiveSystem.archivedPrograms.find(p => p.id === programId);
          
          if (program && program.videoId) {
            // è·³è½‰åˆ°å½±ç‰‡æ’­æ”¾é é¢
            window.open(`video.html?id=${program.videoId}`, '_blank');
          }
        }
      });

      // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function() {
        generateWeekOptions();
        initArchiveSystem();
      });

    })();
  </script>
</body>
</html>
