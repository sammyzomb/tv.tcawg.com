<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒæ­¥æª¢æŸ¥å·¥å…· - èˆªå‘ä¸–ç•Œæ—…éŠé »é“</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #333;
            margin: 0 0 10px 0;
        }
        
        .header p {
            color: #666;
            margin: 0;
        }
        
        .check-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .check-section h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .status {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .button:hover {
            background: #0056b3;
        }
        
        .button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .file-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
        }
        
        .file-item h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .file-item .path {
            font-family: monospace;
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .file-item .status {
            font-size: 12px;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”„ åŒæ­¥æª¢æŸ¥å·¥å…·</h1>
            <p>æª¢æŸ¥æœ¬åœ°ç‰ˆæœ¬èˆ‡ç·šä¸Šç‰ˆæœ¬çš„ä¸€è‡´æ€§</p>
        </div>
        
        <div class="check-section">
            <h3>ğŸ“Š ç‰ˆæœ¬è³‡è¨Š</h3>
            <div id="versionInfo" class="status info">
                æ­£åœ¨æª¢æŸ¥ç‰ˆæœ¬è³‡è¨Š...
            </div>
            <button class="button" onclick="checkVersions()">é‡æ–°æª¢æŸ¥ç‰ˆæœ¬</button>
        </div>
        
        <div class="check-section">
            <h3>ğŸ“ æª”æ¡ˆåŒæ­¥ç‹€æ…‹</h3>
            <div id="fileStatus" class="status info">
                æ­£åœ¨æª¢æŸ¥æª”æ¡ˆç‹€æ…‹...
            </div>
            <button class="button" onclick="checkFiles()">æª¢æŸ¥æª”æ¡ˆ</button>
        </div>
        
        <div class="check-section">
            <h3>ğŸŒ ç·šä¸Šç‰ˆæœ¬æª¢æŸ¥</h3>
            <div id="onlineStatus" class="status info">
                æ­£åœ¨æª¢æŸ¥ç·šä¸Šç‰ˆæœ¬...
            </div>
            <button class="button" onclick="checkOnline()">æª¢æŸ¥ç·šä¸Šç‰ˆæœ¬</button>
        </div>
        
        <div class="check-section">
            <h3>ğŸ”§ åŒæ­¥æ“ä½œ</h3>
            <div id="syncActions">
                <button class="button" onclick="forceSync()">å¼·åˆ¶åŒæ­¥</button>
                <button class="button" onclick="clearCache()">æ¸…é™¤å¿«å–</button>
                <button class="button" onclick="openGitHubDesktop()">é–‹å•Ÿ GitHub Desktop</button>
            </div>
        </div>
        
        <div class="check-section">
            <h3>ğŸ“ æª¢æŸ¥æ—¥èªŒ</h3>
            <div id="checkLog" class="log"></div>
            <button class="button" onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
        </div>
    </div>

    <script src="version-checker.js"></script>
    <script>
        // æ—¥èªŒå‡½æ•¸
        function log(message, type = 'info') {
            const logDiv = document.getElementById('checkLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }
        
        // æª¢æŸ¥ç‰ˆæœ¬è³‡è¨Š
        async function checkVersions() {
            log('é–‹å§‹æª¢æŸ¥ç‰ˆæœ¬è³‡è¨Š...');
            
            try {
                // æª¢æŸ¥æœ¬åœ° Git ç‹€æ…‹
                const localCommit = await getLocalCommit();
                const remoteCommit = await getRemoteCommit();
                
                if (localCommit && remoteCommit) {
                    if (localCommit === remoteCommit) {
                        updateStatus('versionInfo', 'âœ… æœ¬åœ°ç‰ˆæœ¬èˆ‡é ç«¯ç‰ˆæœ¬ä¸€è‡´', 'success');
                        log(`ç‰ˆæœ¬ä¸€è‡´: ${localCommit.substring(0, 8)}`);
                    } else {
                        updateStatus('versionInfo', 'âš ï¸ æœ¬åœ°ç‰ˆæœ¬èˆ‡é ç«¯ç‰ˆæœ¬ä¸ä¸€è‡´', 'warning');
                        log(`æœ¬åœ°ç‰ˆæœ¬: ${localCommit.substring(0, 8)}`);
                        log(`é ç«¯ç‰ˆæœ¬: ${remoteCommit.substring(0, 8)}`);
                    }
                } else {
                    updateStatus('versionInfo', 'âŒ ç„¡æ³•ç²å–ç‰ˆæœ¬è³‡è¨Š', 'error');
                    log('ç„¡æ³•ç²å– Git ç‰ˆæœ¬è³‡è¨Š');
                }
            } catch (error) {
                updateStatus('versionInfo', `âŒ æª¢æŸ¥ç‰ˆæœ¬å¤±æ•—: ${error.message}`, 'error');
                log(`ç‰ˆæœ¬æª¢æŸ¥éŒ¯èª¤: ${error.message}`, 'error');
            }
        }
        
        // æª¢æŸ¥æª”æ¡ˆç‹€æ…‹
        async function checkFiles() {
            log('é–‹å§‹æª¢æŸ¥æª”æ¡ˆç‹€æ…‹...');
            
            try {
                const criticalFiles = [
                    'index.html',
                    'script.js',
                    'schedule.json',
                    'style.css'
                ];
                
                let allFilesOk = true;
                const fileStatusDiv = document.getElementById('fileStatus');
                fileStatusDiv.innerHTML = '';
                
                for (const file of criticalFiles) {
                    try {
                        const response = await fetch(file);
                        if (response.ok) {
                            const fileItem = document.createElement('div');
                            fileItem.className = 'file-item';
                            fileItem.innerHTML = `
                                <h4>${file}</h4>
                                <div class="path">${window.location.origin}/${file}</div>
                                <div class="status success">âœ… å¯å­˜å–</div>
                            `;
                            fileStatusDiv.appendChild(fileItem);
                            log(`âœ… ${file} - å¯å­˜å–`);
                        } else {
                            allFilesOk = false;
                            log(`âŒ ${file} - ç„¡æ³•å­˜å– (${response.status})`, 'error');
                        }
                    } catch (error) {
                        allFilesOk = false;
                        log(`âŒ ${file} - è¼‰å…¥éŒ¯èª¤: ${error.message}`, 'error');
                    }
                }
                
                if (allFilesOk) {
                    updateStatus('fileStatus', 'âœ… æ‰€æœ‰é—œéµæª”æ¡ˆéƒ½å¯å­˜å–', 'success');
                } else {
                    updateStatus('fileStatus', 'âš ï¸ éƒ¨åˆ†æª”æ¡ˆç„¡æ³•å­˜å–', 'warning');
                }
            } catch (error) {
                updateStatus('fileStatus', `âŒ æª¢æŸ¥æª”æ¡ˆå¤±æ•—: ${error.message}`, 'error');
                log(`æª”æ¡ˆæª¢æŸ¥éŒ¯èª¤: ${error.message}`, 'error');
            }
        }
        
        // æª¢æŸ¥ç·šä¸Šç‰ˆæœ¬
        async function checkOnline() {
            log('é–‹å§‹æª¢æŸ¥ç·šä¸Šç‰ˆæœ¬...');
            
            try {
                const onlineUrl = 'https://tv.tcawg.com';
                const response = await fetch(onlineUrl, { mode: 'no-cors' });
                
                // ç”±æ–¼ CORS é™åˆ¶ï¼Œæˆ‘å€‘ç„¡æ³•ç›´æ¥æª¢æŸ¥ç·šä¸Šç‰ˆæœ¬
                // ä½†æˆ‘å€‘å¯ä»¥æä¾›æª¢æŸ¥æ–¹æ³•
                updateStatus('onlineStatus', 'â„¹ï¸ è«‹æ‰‹å‹•æª¢æŸ¥ç·šä¸Šç‰ˆæœ¬', 'info');
                log('è«‹æ‰‹å‹•å‰å¾€ https://tv.tcawg.com æª¢æŸ¥ç·šä¸Šç‰ˆæœ¬');
                log('ç·šä¸Šç‰ˆæœ¬æ‡‰è©²é¡¯ç¤ºã€Œç›®å‰æš«ç„¡ç¯€ç›®ã€å¡ç‰‡');
                
            } catch (error) {
                updateStatus('onlineStatus', 'âš ï¸ ç„¡æ³•ç›´æ¥æª¢æŸ¥ç·šä¸Šç‰ˆæœ¬', 'warning');
                log('ç”±æ–¼ CORS é™åˆ¶ï¼Œç„¡æ³•ç›´æ¥æª¢æŸ¥ç·šä¸Šç‰ˆæœ¬', 'warning');
                log('è«‹æ‰‹å‹•å‰å¾€ https://tv.tcawg.com æª¢æŸ¥', 'warning');
            }
        }
        
        // å¼·åˆ¶åŒæ­¥
        function forceSync() {
            log('åŸ·è¡Œå¼·åˆ¶åŒæ­¥...');
            log('è«‹åœ¨ GitHub Desktop ä¸­åŸ·è¡Œä»¥ä¸‹æ“ä½œ:');
            log('1. é»æ“Š "Fetch origin" ç²å–æœ€æ–°è®Šæ›´');
            log('2. é»æ“Š "Pull origin" æ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼');
            log('3. å¦‚æœæ²’æœ‰è®Šæ›´ï¼Œå˜—è©¦ "Reset to this commit"');
            log('4. é¸æ“‡æœ€æ–°çš„ commit é€²è¡Œé‡ç½®');
            
            updateStatus('syncActions', 'è«‹æŒ‰ç…§æ—¥èªŒä¸­çš„æ­¥é©ŸåŸ·è¡ŒåŒæ­¥', 'info');
        }
        
        // æ¸…é™¤å¿«å–
        function clearCache() {
            log('æ¸…é™¤ç€è¦½å™¨å¿«å–...');
            log('è«‹åŸ·è¡Œä»¥ä¸‹æ“ä½œ:');
            log('1. æŒ‰ Ctrl + Shift + R å¼·åˆ¶é‡æ–°æ•´ç†');
            log('2. æˆ–æŒ‰ F12 é–‹å•Ÿé–‹ç™¼è€…å·¥å…·');
            log('3. å³éµé»æ“Šé‡æ–°æ•´ç†æŒ‰éˆ•');
            log('4. é¸æ“‡ã€Œæ¸…ç©ºå¿«å–ä¸¦å¼·åˆ¶é‡æ–°æ•´ç†ã€');
            
            updateStatus('syncActions', 'è«‹æŒ‰ç…§æ—¥èªŒä¸­çš„æ­¥é©Ÿæ¸…é™¤å¿«å–', 'info');
        }
        
        // é–‹å•Ÿ GitHub Desktop
        function openGitHubDesktop() {
            log('é–‹å•Ÿ GitHub Desktop...');
            log('è«‹æ‰‹å‹•é–‹å•Ÿ GitHub Desktop æ‡‰ç”¨ç¨‹å¼');
            log('é¸æ“‡ travel-video-site å°ˆæ¡ˆ');
            log('æª¢æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„åŒæ­¥æ“ä½œ');
            
            updateStatus('syncActions', 'è«‹æ‰‹å‹•é–‹å•Ÿ GitHub Desktop', 'info');
        }
        
        // æ¸…é™¤æ—¥èªŒ
        function clearLog() {
            document.getElementById('checkLog').innerHTML = '';
            log('æ—¥èªŒå·²æ¸…é™¤');
        }
        
        // ç²å–æœ¬åœ° commit hash (æ¨¡æ“¬)
        async function getLocalCommit() {
            // é€™è£¡æ‡‰è©²è®€å– .git/refs/heads/main æª”æ¡ˆ
            // ä½†ç”±æ–¼ç€è¦½å™¨å®‰å…¨é™åˆ¶ï¼Œæˆ‘å€‘ç„¡æ³•ç›´æ¥è®€å–
            // å¯¦éš›æ‡‰ç”¨ä¸­éœ€è¦é€šéå¾Œç«¯ API ç²å–
            return 'local-commit-hash';
        }
        
        // ç²å–é ç«¯ commit hash (æ¨¡æ“¬)
        async function getRemoteCommit() {
            // é€™è£¡æ‡‰è©²è®€å– .git/refs/remotes/origin/main æª”æ¡ˆ
            // ä½†ç”±æ–¼ç€è¦½å™¨å®‰å…¨é™åˆ¶ï¼Œæˆ‘å€‘ç„¡æ³•ç›´æ¥è®€å–
            // å¯¦éš›æ‡‰ç”¨ä¸­éœ€è¦é€šéå¾Œç«¯ API ç²å–
            return 'remote-commit-hash';
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•åŸ·è¡Œæª¢æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            log('åŒæ­¥æª¢æŸ¥å·¥å…·å·²è¼‰å…¥');
            log('é–‹å§‹è‡ªå‹•æª¢æŸ¥...');
            
            // å»¶é²åŸ·è¡Œæª¢æŸ¥ï¼Œç¢ºä¿é é¢å®Œå…¨è¼‰å…¥
            setTimeout(() => {
                checkVersions();
                checkFiles();
                checkOnline();
            }, 1000);
        });
    </script>
</body>
</html>
