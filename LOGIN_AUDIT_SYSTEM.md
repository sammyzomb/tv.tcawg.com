# 🔐 登入審計系統說明

## 📋 系統概述

本系統為管理員登入提供完整的審計和日誌記錄功能，包含以下特性：

### ✅ 主要功能

1. **完整的登入日誌記錄**
   - 記錄所有登入嘗試（成功/失敗）
   - 記錄用戶輸入的帳號和密碼（遮罩處理）
   - 記錄 IP 地址和用戶代理
   - 記錄登入時間和會話 ID

2. **IP 封鎖機制**
   - 自動檢測暴力破解攻擊
   - 15分鐘內失敗5次自動封鎖 IP
   - 超級管理員可手動解除封鎖

3. **權限管理**
   - 超級管理員：完整權限，可解除 IP 封鎖
   - 一般管理員：查看權限，可查看日誌和統計

4. **日誌管理功能**
   - 搜尋和篩選日誌
   - 匯出 CSV 格式
   - 自動清理舊日誌
   - 統計分析

## 🔧 使用方法

### 訪問登入日誌管理頁面

1. **登入管理系統**
   - 使用管理員帳號登入 `admin-login.html`

2. **訪問日誌頁面**
   - 直接訪問 `admin-login-logs.html`
   - 或從管理後台導航到日誌管理

### 查看日誌記錄

1. **統計資訊**
   - 總登入嘗試次數
   - 成功/失敗登入次數
   - 成功率百分比
   - 被封鎖 IP 數量

2. **搜尋功能**
   - 按電子郵件搜尋
   - 按 IP 地址搜尋
   - 按登入狀態篩選
   - 按時間範圍篩選

3. **日誌詳情**
   - 登入時間
   - 用戶帳號
   - IP 地址
   - 密碼（遮罩顯示）
   - 登入結果
   - 失敗原因

### 管理被封鎖的 IP

1. **查看封鎖清單**
   - 顯示所有被封鎖的 IP
   - 封鎖時間和原因
   - 嘗試次數

2. **解除封鎖**（僅超級管理員）
   - 點擊「解除封鎖」按鈕
   - 確認操作
   - IP 立即解除封鎖

### 匯出功能

1. **匯出選項**
   - 匯出所有日誌
   - 匯出失敗日誌
   - 匯出封鎖清單

2. **CSV 格式**
   - 包含所有詳細資訊
   - 可用 Excel 開啟
   - 支援中文編碼

## 🔒 安全特性

### 密碼保護
- 密碼以遮罩形式顯示（如：`D****@`）
- 只顯示首尾字符，中間用星號替代

### IP 封鎖
- 自動檢測異常登入行為
- 防止暴力破解攻擊
- 15分鐘自動解除封鎖

### 權限控制
- 不同管理員等級有不同權限
- 只有超級管理員可解除 IP 封鎖
- 一般管理員只能查看日誌

## 📊 日誌格式

### 日誌條目包含：
```json
{
  "id": "log_1234567890_abc123",
  "timestamp": "2024-12-31T12:00:00.000Z",
  "email": "user@example.com",
  "password": "D****@",
  "ipAddress": "192.168.1.100",
  "userAgent": "Mozilla/5.0...",
  "success": true,
  "reason": "登入成功",
  "sessionId": "session_1234567890_xyz789"
}
```

### 封鎖條目包含：
```json
{
  "ipAddress": "192.168.1.100",
  "email": "user@example.com",
  "blockedAt": "2024-12-31T12:00:00.000Z",
  "reason": "Too many failed login attempts",
  "attempts": 5
}
```

## 🛠️ 技術實現

### 儲存方式
- 使用瀏覽器 localStorage 儲存
- 最多保留 1000 條日誌記錄
- 自動清理 30 天前的舊日誌

### IP 獲取
- 使用多個外部服務獲取真實 IP
- 備用方案：本地 IP (127.0.0.1)

### 安全性
- 所有敏感資訊都經過遮罩處理
- 日誌記錄不會暴露完整密碼
- 支援 Contentful 整合（可選）

## 📝 注意事項

1. **瀏覽器限制**
   - 日誌儲存在本地瀏覽器
   - 清除瀏覽器資料會遺失日誌
   - 建議定期匯出備份

2. **IP 封鎖**
   - 封鎖時間為 15 分鐘
   - 只有超級管理員可手動解除
   - 建議定期檢查封鎖清單

3. **效能考量**
   - 日誌數量過多可能影響效能
   - 建議定期清理舊日誌
   - 可調整最大日誌數量限制

## 🔄 未來改進

1. **伺服器端儲存**
   - 將日誌儲存到伺服器
   - 支援多設備同步
   - 更安全的資料保護

2. **即時通知**
   - 異常登入即時通知
   - 郵件或簡訊警報
   - 管理員儀表板

3. **進階分析**
   - 登入模式分析
   - 異常行為檢測
   - 風險評分系統

---

**版本：** 1.0  
**最後更新：** 2024-12-31  
**維護者：** 航向世界旅遊頻道技術團隊
